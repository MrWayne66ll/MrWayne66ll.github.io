<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT">










<meta property="og:type" content="website">
<meta property="og:title" content="枫川棂">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="枫川棂">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="枫川棂">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/">





  <title>枫川棂</title>
  








</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">枫川棂</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">Come From FCL.PDD</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/12/17/kafka1/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="fengchuanling">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="枫川棂">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/12/17/kafka1/" itemprop="url">kafka使用（二）- kafka安装和基本操作</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-12-17T14:58:17+08:00">
                2018-12-17
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/kafka/" itemprop="url" rel="index">
                    <span itemprop="name">kafka</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="2-kafka-在centos7上的安装"><a href="#2-kafka-在centos7上的安装" class="headerlink" title="2. kafka 在centos7上的安装"></a>2. kafka 在centos7上的安装</h1><h2 id="2-1-因为kafka是使用zookeeper保存相关的配置信息的，kafka以及zookeeper依赖于java运行环境，先进行java的JDK环境安装"><a href="#2-1-因为kafka是使用zookeeper保存相关的配置信息的，kafka以及zookeeper依赖于java运行环境，先进行java的JDK环境安装" class="headerlink" title="2.1 因为kafka是使用zookeeper保存相关的配置信息的，kafka以及zookeeper依赖于java运行环境，先进行java的JDK环境安装"></a>2.1 因为kafka是使用zookeeper保存相关的配置信息的，kafka以及zookeeper依赖于java运行环境，先进行java的JDK环境安装</h2><blockquote>
<p>因为centos7上游jdk1.8环境，所以无需安装配置java</p>
</blockquote>
<h2 id="2-2-安装zookeeper"><a href="#2-2-安装zookeeper" class="headerlink" title="2.2 安装zookeeper"></a>2.2 安装zookeeper</h2><h4 id="1）官网下载最新版的zookeeper：http-zookeeper-apache-org-releases-html"><a href="#1）官网下载最新版的zookeeper：http-zookeeper-apache-org-releases-html" class="headerlink" title="1）官网下载最新版的zookeeper：http://zookeeper.apache.org/releases.html"></a>1）官网下载最新版的zookeeper：<a href="http://zookeeper.apache.org/releases.html" target="_blank" rel="noopener">http://zookeeper.apache.org/releases.html</a></h4><h4 id="2）解压文件，并在文件下创建data目录"><a href="#2）解压文件，并在文件下创建data目录" class="headerlink" title="2）解压文件，并在文件下创建data目录"></a>2）解压文件，并在文件下创建data目录</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">tar -zxf zookeeper-3.4.6.tar.gz</span><br><span class="line">cd zookeeper-3.4.6</span><br><span class="line">mkdir data</span><br></pre></td></tr></table></figure>
<h4 id="3）自行创建zookeeper的启动配置文件：conf-zoo-cfg"><a href="#3）自行创建zookeeper的启动配置文件：conf-zoo-cfg" class="headerlink" title="3）自行创建zookeeper的启动配置文件：conf/zoo.cfg"></a>3）自行创建zookeeper的启动配置文件：conf/zoo.cfg</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">tickTime=2000</span><br><span class="line">dataDir=/path/to/zookeeper/data</span><br><span class="line">clientPort=2181</span><br><span class="line">initLimit=5</span><br><span class="line">syncLimit=2</span><br></pre></td></tr></table></figure>
<h4 id="4）zookeeper命令："><a href="#4）zookeeper命令：" class="headerlink" title="4）zookeeper命令："></a>4）zookeeper命令：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">bin/zkServer.sh start		// 启动zookeeper server</span><br><span class="line">bin/zkServer.sh stop		// 关闭</span><br><span class="line">in/zkCli.sh					// 打开cli</span><br></pre></td></tr></table></figure>
<h2 id="2-3-安装kafka"><a href="#2-3-安装kafka" class="headerlink" title="2.3 安装kafka"></a>2.3 安装kafka</h2><h4 id="1）官网下载kafka的安装包：https-www-apache-org-dyn-closer-cgi-path-kafka-0-9-0-0-kafka-2-11-0-9-0-0-tgz"><a href="#1）官网下载kafka的安装包：https-www-apache-org-dyn-closer-cgi-path-kafka-0-9-0-0-kafka-2-11-0-9-0-0-tgz" class="headerlink" title="1）官网下载kafka的安装包：https://www.apache.org/dyn/closer.cgi?path=/kafka/0.9.0.0/kafka_2.11-0.9.0.0.tgz"></a>1）官网下载kafka的安装包：<a href="https://www.apache.org/dyn/closer.cgi?path=/kafka/0.9.0.0/kafka_2.11-0.9.0.0.tgz" target="_blank" rel="noopener">https://www.apache.org/dyn/closer.cgi?path=/kafka/0.9.0.0/kafka_2.11-0.9.0.0.tgz</a></h4><h4 id="2）解压下载包："><a href="#2）解压下载包：" class="headerlink" title="2）解压下载包："></a>2）解压下载包：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tar -zxf kafka_2.11.0.9.0.0 tar.gz</span><br><span class="line">cd kafka_2.11.0.9.0.0</span><br></pre></td></tr></table></figure>
<h4 id="3）kafka命令："><a href="#3）kafka命令：" class="headerlink" title="3）kafka命令："></a>3）kafka命令：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">bin/kafka-server-start.sh config/server.properties	// 启动服务	</span><br><span class="line">bin/kafka-server-stop.sh config/server.properties	// 停止服务</span><br></pre></td></tr></table></figure>
<h2 id="2-4-kafka基本操作"><a href="#2-4-kafka基本操作" class="headerlink" title="2.4 kafka基本操作"></a>2.4 kafka基本操作</h2><h4 id="1）topic-操作"><a href="#1）topic-操作" class="headerlink" title="1）topic 操作"></a>1）topic 操作</h4><h5 id="1-1）创建"><a href="#1-1）创建" class="headerlink" title="1.1）创建"></a>1.1）创建</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/kafka-topics.sh --create --zookeeper localhost:2181 --replication-factor 1 --partitions 1 --topic topic-name</span><br></pre></td></tr></table></figure>
<h5 id="1-2）修改"><a href="#1-2）修改" class="headerlink" title="1.2）修改"></a>1.2）修改</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/kafka-topics.sh —zookeeper localhost:2181 --alter --topic topic_name --parti-tions count</span><br></pre></td></tr></table></figure>
<h5 id="1-3）删除"><a href="#1-3）删除" class="headerlink" title="1.3）删除"></a>1.3）删除</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/kafka-topics.sh --zookeeper localhost:2181 --delete --topic topic_name</span><br></pre></td></tr></table></figure>
<h4 id="2）获取kafka服务器中的topic列表"><a href="#2）获取kafka服务器中的topic列表" class="headerlink" title="2）获取kafka服务器中的topic列表"></a>2）获取kafka服务器中的topic列表</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/kafka-topics.sh --list --zookeeper localhost:2181</span><br></pre></td></tr></table></figure>
<h4 id="3）启动kafka生产者以发送消息"><a href="#3）启动kafka生产者以发送消息" class="headerlink" title="3）启动kafka生产者以发送消息"></a>3）启动kafka生产者以发送消息</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/kafka-console-producer.sh --broker-list localhost:9092 --topic topic-name</span><br></pre></td></tr></table></figure>
<blockquote>
<p>启动之后，生产者将等待来自stdin的输入，并发送到kafka集群。默认情况下，每个新行都作为消息发布，然后在”config/producer.properties”文件中指定默认生产者属性。</p>
</blockquote>
<h4 id="4）启动kafka消费者以获得消息"><a href="#4）启动kafka消费者以获得消息" class="headerlink" title="4）启动kafka消费者以获得消息"></a>4）启动kafka消费者以获得消息</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/kafka-console-consumer.sh --zookeeper localhost:2181 --topic topic-name --from-beginning</span><br></pre></td></tr></table></figure>
<h4 id="5）单节点多代理配置"><a href="#5）单节点多代理配置" class="headerlink" title="5）单节点多代理配置"></a>5）单节点多代理配置</h4><blockquote>
<p>创建多个kafka broker<br><br>在config下新建多个 server.properties，修改下面的id、prot和logdir<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># The id of the broker. This must be set to a unique integer for each broker.</span><br><span class="line">broker.id=1</span><br><span class="line"># The port the socket server listens on</span><br><span class="line">port=9093</span><br><span class="line"># A comma seperated list of directories under which to store log files</span><br><span class="line">log.dirs=/tmp/kafka-logs-1</span><br></pre></td></tr></table></figure></p>
</blockquote>
<blockquote>
<p>然后根据配置文件启动他们<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/kafka-server-start.sh config/server.properties</span><br></pre></td></tr></table></figure></p>
</blockquote>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/12/16/kafka2/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="fengchuanling">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="枫川棂">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/12/16/kafka2/" itemprop="url">kafka使用（一）- 概念理解</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-12-16T20:01:36+08:00">
                2018-12-16
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/kafka/" itemprop="url" rel="index">
                    <span itemprop="name">kafka</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="0-概念"><a href="#0-概念" class="headerlink" title="0. 概念"></a>0. 概念</h1><h2 id="0-1-消息系统"><a href="#0-1-消息系统" class="headerlink" title="0.1 消息系统"></a>0.1 消息系统</h2><blockquote>
<p>消息系统负责将数据从一个应用程序传输到另一个应用程序，因此应用程序可以专注于数据，而不用担心怎么去共享它。</p>
</blockquote>
<h4 id="1）点对点消息系统："><a href="#1）点对点消息系统：" class="headerlink" title="1）点对点消息系统："></a>1）点对点消息系统：</h4><blockquote>
<p>消息被保留在队列中，一个或多个消费者可以消耗队列中的消息，但是特定的消息只能由一个消费者消费，一旦消费掉了，消息就会从队列中消失。</p>
</blockquote>
<h4 id="2）发布-订阅-消息系统"><a href="#2）发布-订阅-消息系统" class="headerlink" title="2）发布-订阅 消息系统"></a>2）发布-订阅 消息系统</h4><blockquote>
<p>消息被保留在主题中，与点对点的系统不同，消费者可以订阅一个或多个主题，并使用该主题中的所有消息</p>
</blockquote>
<h2 id="0-2-LinkedIn开源"><a href="#0-2-LinkedIn开源" class="headerlink" title="0.2 LinkedIn开源"></a>0.2 LinkedIn开源</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1）Databus 分布式数据同步系统</span><br><span class="line">2）Cubert 高性能计算引擎</span><br><span class="line">3）ParSeq Java一部处理框架</span><br><span class="line">4）kafka 流处理平台</span><br></pre></td></tr></table></figure>
<h1 id="1-kafka介绍"><a href="#1-kafka介绍" class="headerlink" title="1. kafka介绍"></a>1. kafka介绍</h1><h2 id="1-1-kafka工作流程"><a href="#1-1-kafka工作流程" class="headerlink" title="1.1 kafka工作流程"></a>1.1 kafka工作流程</h2><h3 id="1-1-1-发布-订阅工作流程"><a href="#1-1-1-发布-订阅工作流程" class="headerlink" title="1.1.1 发布-订阅工作流程"></a>1.1.1 发布-订阅工作流程</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">1）生产者定期向主题发送消息</span><br><span class="line">2）kafka代理存储为该特定主题的分区中的所有消息，它确保消息在分区之间的平等共享</span><br><span class="line">3）消费者订阅特定的消息</span><br><span class="line">4）一旦消费者订阅了相应的主题，kafka将会向消费者提供主题的当前便宜，并且还将保存在zookeeper中</span><br><span class="line">5）消费者将定期请求kafka的新消息</span><br><span class="line">6）一旦kafka收到来自生产者的消息，它将这些消息转发给消费者</span><br><span class="line">7）消费者将接受这些消息并且进行处理</span><br><span class="line">8）一旦消息被处理了，消费者将向kafka代理发送确认</span><br><span class="line">9）一旦kafka收到确认，它将便宜改为新值，并在zookeeper中更新它</span><br><span class="line">10）以上流程将重复，直到消费者停止请求</span><br><span class="line">11）消费者可以随时退回/跳到所需要的主题的偏移量，并阅读所有后续的消息</span><br></pre></td></tr></table></figure>
<h3 id="1-1-2-队列消息-用户组的工作流"><a href="#1-1-2-队列消息-用户组的工作流" class="headerlink" title="1.1.2 队列消息/用户组的工作流"></a>1.1.2 队列消息/用户组的工作流</h3><blockquote>
<p>在队列消息传递系统而不是单个消费者中，具有相同的”组ID”的一组消费者将订阅主题。简单来说，订阅具有相同groupid的主题的消费者被认为是单个组，并且消息在他们之中共享。一下为工作流程“<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1）生产者以固定间隔向某个主题发送消息</span><br><span class="line">2）Kafka存储在为该特定主题配置的分区中的所有消息，类似于前面的方案</span><br><span class="line">3）单个消费者订阅特定主题，</span><br><span class="line">4）kafka以发布-订阅消息的方式同消费者交互，知道新的消费者以相同的组id订阅相同的主题topic</span><br><span class="line">5）一旦新的消费者到达，kafka将其操作切换为共享模式，并在两个消费者之间共享数据</span><br><span class="line">6）一旦消费者数量超过分区数量，新消费者将不会接收到任何进一步消息，知道现有的消费者取消订阅，出现这种情况是因为kafka中的每个消费者将被分配到至少一个分区，一旦所有分区都被分配给消费者之后，新的消费者必须等待</span><br></pre></td></tr></table></figure></p>
</blockquote>
<h2 id="1-2-kafka-官方介绍"><a href="#1-2-kafka-官方介绍" class="headerlink" title="1.2 kafka 官方介绍"></a>1.2 kafka 官方介绍</h2><blockquote>
<p>是一个分布式流处理平台</p>
</blockquote>
<h2 id="1-3-基本概念"><a href="#1-3-基本概念" class="headerlink" title="1.3 基本概念"></a>1.3 基本概念</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">1）Producer：消息和数据的生产者，向kafka的一个topic发布消息的进程/代码/服务</span><br><span class="line">2）Consumer：消息和数据的消费者，订阅数据(Topic)并且处理其发布的消息的进程/代码/服务</span><br><span class="line">3）Consumer Group：一个group只有一个consumer能消费这个订阅的消息</span><br><span class="line">4）Broker：kafka集群中的每个kafka节点</span><br><span class="line">5）Topic：消息的类别，对数据进行区分、隔离</span><br><span class="line">6）Partition：一个Topic下的数据分散存储在多个Partition上，Partition是有序的</span><br><span class="line">  每个Topic被切分为多个partitions</span><br><span class="line">  消费者数目少于或等于Partition的数目</span><br><span class="line">  broker group中的每个brioker保存topic的一个或多个partition，同一个partition不会被多个几次保存在多个broker上</span><br><span class="line">  consumergroup中的仅有一个consumer读取topic的一个或多个partitions，并且是唯一的consumer</span><br><span class="line">7）Partition offset</span><br><span class="line">  每个分区消息具有称为 offset 的唯一序列标识</span><br><span class="line">8）Replication：一个partition可能有多个副本</span><br><span class="line">  当集群中有broker挂掉的情况下，系统可以主动使用replicas提供服务</span><br><span class="line">  系统默认设置每个topic的replication系数为1，可以创建topic时单独设置</span><br><span class="line">  replication的剧本单位是topic的partition</span><br><span class="line">  所有的读和写都是从leader进，followers只是为了做备份</span><br><span class="line">  followers必须能够即使复制leader的数据</span><br><span class="line">  增加容错性与可扩展性</span><br><span class="line">9）Replication Leader：负责该partition与consumer的交互</span><br><span class="line">10）ReplicaManager：负责管理当前的broker所有分区和副本的信息，处理kafkaController发起的一些请求，副本状态的切换、添加、读取消息等</span><br></pre></td></tr></table></figure>
<h2 id="1-4-kafka消息结构"><a href="#1-4-kafka消息结构" class="headerlink" title="1.4 kafka消息结构"></a>1.4 kafka消息结构</h2><blockquote>
<p>offset|length|crc32|magic|attributes|timestamp|key length|key|value length|value</p>
</blockquote>
<h2 id="1-5-api分类"><a href="#1-5-api分类" class="headerlink" title="1.5 api分类"></a>1.5 api分类</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Producer Api</span><br><span class="line">Consumer Api</span><br><span class="line">Streams Api</span><br><span class="line">Connectors Api</span><br></pre></td></tr></table></figure>
<p><img src="https://img2018.cnblogs.com/blog/1075630/201812/1075630-20181216201828907-782599435.png" alt=""></p>
<h2 id="1-6-kafka特点"><a href="#1-6-kafka特点" class="headerlink" title="1.6 kafka特点"></a>1.6 kafka特点</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1）分布式：多分区，多副本，多订阅者，基于zookeeper调度（记录broker、topic、partition信息）</span><br><span class="line">2）高性能：高吞吐量、低延迟、高并发、时间复杂度为O(1)</span><br><span class="line">3）持久性与扩展性：数据可持久化、容错性、支持在线水平扩展、消息自动平衡（避免数据集中在某几台机器上导致频繁地访问某几台机器，产生一种热点的问题）</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/12/16/sql/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="fengchuanling">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="枫川棂">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/12/16/sql/" itemprop="url">sql 回顾（mysql）</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-12-16T18:54:28+08:00">
                2018-12-16
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/sql/" itemprop="url" rel="index">
                    <span itemprop="name">sql</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="sql-回顾（mysql）"><a href="#sql-回顾（mysql）" class="headerlink" title="sql 回顾（mysql）"></a>sql 回顾（mysql）</h1><p>##1. mysql数据类型</p>
<blockquote>
<p>一共三种：Text、Number、Data/Time</p>
</blockquote>
<h3 id="1-1-Text"><a href="#1-1-Text" class="headerlink" title="1.1 Text"></a>1.1 Text</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">1）CHAR(size)	        最大255</span><br><span class="line">2）VARCHAR(size)	如果大于255，则自动转化为TEXT</span><br><span class="line">3）TINYTEXT		存放最大长度为255</span><br><span class="line">4）TEXT			存放最大长度为65535</span><br><span class="line">5）BLOB			用于BLOBs，存放最多65535</span><br><span class="line">6）MEDIUMTEXT	        存放最大长度为16,777,215</span><br><span class="line">7）MEDIUMBLOB	        存放最大长度为16,777,215</span><br><span class="line">8）LONGTEXT		存放最大长度为4,294,967,295</span><br><span class="line">9）LONGBLOB		存放最大长度为4,294,967,295</span><br><span class="line">10）ENUM(x,y,z,etc.)</span><br><span class="line">11）SET</span><br></pre></td></tr></table></figure>
<h3 id="1-2-Number"><a href="#1-2-Number" class="headerlink" title="1.2 Number"></a>1.2 Number</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">1）TINYINT(size)	带符号-128到127，无符号0到255</span><br><span class="line">2）SMALLINT(size)	带符号-32768到32767，无符号0到65535</span><br><span class="line">3）MEDIUMINT(size)	带符号-8388608到8388607，无符号0到16777215</span><br><span class="line">4）INT(size)		带符号-2147483648到2147483647，无符号0到4294967295</span><br><span class="line">5）BIGINT(size)		带符号-9223372036854775808到9223372036854775807，无符号0到18446744073709551615</span><br><span class="line">6）FLOAT(size,d)	带有浮动小数点的小数字。在 size 参数中规定显示最大位数。在 d 参数中规定小数点右侧的最大位数。</span><br><span class="line">7）DOUBLE(size,d)	同上</span><br><span class="line">8）DECIMAL(size,d)	作为字符串存储的 DOUBLE 类型，允许固定的小数点。在 size 参数中规定显示最大位数。在 d 参数中规定小数点右侧的最大位数。</span><br></pre></td></tr></table></figure>
<h3 id="1-3-Date"><a href="#1-3-Date" class="headerlink" title="1.3 Date"></a>1.3 Date</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1）DATE()		格式：YYYY-MM-DD</span><br><span class="line">2）DATETIME()	        格式：YYYY-MM-DD HH:MM:SS</span><br><span class="line">3）TIMESTAMP()	        时间戳，支持范围：从 &apos;1970-01-01 00:00:01&apos; UTC 到 &apos;2038-01-09 03:14:07&apos; UTC</span><br><span class="line">4）TIME()		格式：HH:MM:SS</span><br><span class="line">5）YEAR()		2 位或 4 位格式的年。4 位格式所允许的值：1901 到 2155。2 位格式所允许的值：70 到 69，表示从 1970 到 2069。</span><br></pre></td></tr></table></figure>
<h2 id="2-CRUD"><a href="#2-CRUD" class="headerlink" title="2. CRUD"></a>2. CRUD</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">select column_name from table_name 		                               // 查看表的某些列</span><br><span class="line">select distinct column_name from table_name		                       // 查看表的某些列，并且行去重</span><br><span class="line">where	                                                                       // 筛选条件</span><br><span class="line">and or</span><br><span class="line">order by column_name ASC|DESC		                                        // 根据某列数据进行排序</span><br><span class="line">insert into table_name value (value1,value2,...)	                        // 表插入数据</span><br><span class="line">insert into table_name (column_name,column_name,...) values (v1,v2,v3,...)	// 表指定列插入数据</span><br><span class="line">update table_name set column_name1=value1,column_name2=value2,... where ......	// 更新表指定行数据</span><br><span class="line">delete from table_name where ......		                                // 与truncate table_name不同的是，可回滚</span><br></pre></td></tr></table></figure>
<h2 id="3-高级查询"><a href="#3-高级查询" class="headerlink" title="3. 高级查询"></a>3. 高级查询</h2><h4 id="1）limit"><a href="#1）limit" class="headerlink" title="1）limit"></a>1）limit</h4><blockquote>
<p>select * from table_name limit x    // 限制行数</p>
</blockquote>
<h4 id="2）like"><a href="#2）like" class="headerlink" title="2）like"></a>2）like</h4><blockquote>
<p>select * from table_name where name like ‘…’    // 定义模糊查询</p>
</blockquote>
<h4 id="3）通配符"><a href="#3）通配符" class="headerlink" title="3）通配符"></a>3）通配符</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">%					代替0个或多个字符</span><br><span class="line">_					代替一个字符</span><br><span class="line">[charlist]				字符列表中的任意一个字符</span><br><span class="line">[^charlist]/[!charlist]	                不在字符列表中的任意一个字符		</span><br><span class="line">^					以此开头字符</span><br></pre></td></tr></table></figure>
<h4 id="4）in"><a href="#4）in" class="headerlink" title="4）in"></a>4）in</h4><blockquote>
<p>select * from table_name where name in (……)    // 允许在where中定义多个值</p>
</blockquote>
<h4 id="5）between…and…"><a href="#5）between…and…" class="headerlink" title="5）between…and…"></a>5）between…and…</h4><blockquote>
<p>select * from table_name where column_name between x and y    // 在某个范围内的</p>
</blockquote>
<h4 id="6）not"><a href="#6）not" class="headerlink" title="6）not"></a>6）not</h4><blockquote>
<p>可以加在in和between前面表示取反</p>
</blockquote>
<h4 id="7）as"><a href="#7）as" class="headerlink" title="7）as"></a>7）as</h4><blockquote>
<p>可以给列或者表取别名</p>
</blockquote>
<h4 id="8）join"><a href="#8）join" class="headerlink" title="8）join"></a>8）join</h4><blockquote>
<p>inner join：如果表中至少一个匹配，则返回行            // 两边都要满足条件<br><br><img src="https://img2018.cnblogs.com/blog/1075630/201812/1075630-20181216151502063-1623200018.gif" alt=""><br>left join：即使右表中没有匹配，也返回行        // 满足左边<br><br><img src="https://img2018.cnblogs.com/blog/1075630/201812/1075630-20181216151520612-84957277.gif" alt=""><br>right join：即使左表中没有匹配，也返回行            // 满足右边<br><br><img src="https://img2018.cnblogs.com/blog/1075630/201812/1075630-20181216151529590-636354180.gif" alt=""><br>full join：只要其中一个表中存在，则返回行            // 保证两张表的数据全量<br><br><img src="https://img2018.cnblogs.com/blog/1075630/201812/1075630-20181216151543827-795907385.gif" alt=""></p>
</blockquote>
<h4 id="9）union"><a href="#9）union" class="headerlink" title="9）union"></a>9）union</h4><blockquote>
<p>合并select查询到的结果，需要查询的是相同的字段。例如：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SELECT country FROM Websites</span><br><span class="line">UNION</span><br><span class="line">SELECT country FROM apps</span><br><span class="line">ORDER BY country;</span><br></pre></td></tr></table></figure></p>
</blockquote>
<blockquote>
<p>这样的话两张表中相同的列会进行去重<br><br>可以使用union all进行合并，取消去重</p>
</blockquote>
<p>##4. sql索引</p>
<blockquote>
<p>在不读取整个表的情况下，索引使数据库能够更快的查找数据<br><br>用户是无法看到索引的，它们只是用来加速查询，但是有索引的表插入数据的时候会更慢一些，因为插入的同时会更新索引<vr><br>语句：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">create index index_name on table_name (column_name)		// 允许使用重复值</span><br><span class="line">create unique index index_name on table_name (column_name)	// 不允许使用重复值</span><br></pre></td></tr></table></figure></vr></p>
</blockquote>
<h2 id="5-sql常用函数："><a href="#5-sql常用函数：" class="headerlink" title="5. sql常用函数："></a>5. sql常用函数：</h2><h4 id="Aggregate"><a href="#Aggregate" class="headerlink" title="Aggregate:"></a>Aggregate:</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">1）AVG()	-	返回平均值</span><br><span class="line">2）COUNT()	-	返回行数</span><br><span class="line">3）FIRST()	-	返回第一个值</span><br><span class="line">4）LAST()	-	返回最后一个值</span><br><span class="line">5）MAX()	-	返回最大值</span><br><span class="line">6）MIN()	-	返回最小值</span><br><span class="line">7）SUM()	-	返回总和</span><br></pre></td></tr></table></figure>
<h4 id="Scalar："><a href="#Scalar：" class="headerlink" title="Scalar："></a>Scalar：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">1）UCASE()	        -	将某个字段转换为大写</span><br><span class="line">2）LCASE()	        -	将某个字段转化为小写</span><br><span class="line">3）MID()	        -	从某个文本字段提取字符</span><br><span class="line">4）SubString(字段,1,end)	-	从某个文本字段提取字符</span><br><span class="line">5）LEN()	        -	返回某个文本字段的长度</span><br><span class="line">6）ROUND()	        -	对某个数值字段进行指定小数位数的四舍五入</span><br><span class="line">7）NOW()	        -	返回当前系统的日期和时间</span><br><span class="line">8）FORMAT()	        -	格式化某个字段的显示方式</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/12/11/airflow4/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="fengchuanling">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="枫川棂">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/12/11/airflow4/" itemprop="url">airflow 文档学习(二) - 概念</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-12-11T18:31:51+08:00">
                2018-12-11
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/python-框架/" itemprop="url" rel="index">
                    <span itemprop="name">python-框架</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="1-核心功能"><a href="#1-核心功能" class="headerlink" title="1. 核心功能"></a>1. 核心功能</h1><h3 id="1-1-DAGs"><a href="#1-1-DAGs" class="headerlink" title="1.1 DAGs"></a>1.1 DAGs</h3><blockquote>
<p>有向无环图<br><br>反映所涉及的task的依赖关系</p>
</blockquote>
<p>注：搜索dag的时候，airflow只会关注同事包含”DAG”和”airflow”字样的py文件</p>
<h3 id="1-2-scope"><a href="#1-2-scope" class="headerlink" title="1.2 scope"></a>1.2 scope</h3><blockquote>
<p>airflow将加载任何可以从DAG file中import的DAG对象，但是它们必须出现在globals()中，例如下面的文件，只有tag_1会被加载，tag_2只会出现在本地scope中<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">dag_1 = DAG(&apos;this_dag_will_be_discovered&apos;)</span><br><span class="line">def my_function():</span><br><span class="line">dag_2 = DAG(&apos;but_this_dag_will_not&apos;)</span><br><span class="line">my_function()</span><br></pre></td></tr></table></figure></p>
</blockquote>
<h3 id="1-3-Default-Arguments"><a href="#1-3-Default-Arguments" class="headerlink" title="1.3 Default Arguments"></a>1.3 Default Arguments</h3><blockquote>
<p>如果一个字典default_args被传给一个DAGs，它将会将其运用到所有的它的operator中。这使得复用default_args变得非常的方便</p>
</blockquote>
<h3 id="1-4-Context-Manager"><a href="#1-4-Context-Manager" class="headerlink" title="1.4 Context Manager"></a>1.4 Context Manager</h3><blockquote>
<p>dags可以被当做一个管理器，去自动的分配新的operators给dag</p>
</blockquote>
<h3 id="1-5-Operators"><a href="#1-5-Operators" class="headerlink" title="1.5 Operators"></a>1.5 Operators</h3><blockquote>
<p>dags描述的是怎么去跑一个工作流，operators决定实际做什么。<br><br>一个operator描述了在一个工作流中的单个task。operators经常但不总是原子的，这意味着他们可以独立存在而不需要去和别的operator分享资源。DAG将确保operators以正确的顺序运行，在这些依赖之外，operator通常是独立运行的，甚至他们肯能运行在不同的机器上。<br><br>这是个非常微妙的关键点：事实上，如果两个operator需要去共享一些信息，就像文件名或者一些小的数据，你应该去考虑将他们合并到一个operator中，如果上述情况确实是无法避免的，airflow有operator的交叉通信（xcom）在文档中有描述。<br><br>并且airflow提供了非常多的通用operator：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">BashOperator </span><br><span class="line">PythonOperator </span><br><span class="line">EmailOperator</span><br><span class="line">SimpleHttpOperator 等等</span><br></pre></td></tr></table></figure></p>
</blockquote>
<h3 id="1-6-DAG-Assignment"><a href="#1-6-DAG-Assignment" class="headerlink" title="1.6 DAG Assignment"></a>1.6 DAG Assignment</h3><blockquote>
<p>operator不用立马被分配给一个dag，但是，一旦operator被分配给了一个dag，它将无法被转移或者是取消分配。dag的分配在operator被创建之后可以被非常明确的完成，通过延期分配或者从其他operator推断的方式<br><br>例如下面的方式：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">dag = DAG(&apos;my_dag&apos;, start_date=datetime(2016, 1, 1))</span><br><span class="line"># sets the DAG explicitly</span><br><span class="line">explicit_op = DummyOperator(task_id=&apos;op1&apos;, dag=dag)</span><br><span class="line"># deferred DAG assignment</span><br><span class="line">deferred_op = DummyOperator(task_id=&apos;op2&apos;)</span><br><span class="line">deferred_op.dag = dag</span><br><span class="line"># inferred DAG assignment (linked operators must be in the same DAG)</span><br><span class="line">inferred_op = DummyOperator(task_id=&apos;op3&apos;)</span><br><span class="line">inferred_op.set_upstream(deferred_op)</span><br></pre></td></tr></table></figure></p>
</blockquote>
<h3 id="1-7-Bitshift-Composition"><a href="#1-7-Bitshift-Composition" class="headerlink" title="1.7 Bitshift Composition"></a>1.7 Bitshift Composition</h3><blockquote>
<p>在以前，operator的关系描述是通过set_upstream()和set_downstream()方法，在1.8 之后可以通过&lt;&lt;和&gt;&gt;代替依赖方法。</p>
</blockquote>
<h3 id="1-8-Tasks"><a href="#1-8-Tasks" class="headerlink" title="1.8 Tasks"></a>1.8 Tasks</h3><blockquote>
<p>当一个operator被实例化之后，它就被称为是一个task。实例化在调用抽象operator时定义了具体的值，同时，参数化之后的task会称为dag的一个节点。</p>
</blockquote>
<h3 id="1-9-Task-Instances"><a href="#1-9-Task-Instances" class="headerlink" title="1.9 Task Instances"></a>1.9 Task Instances</h3><blockquote>
<p>一个task实例代表一个task的特定运行，其特征在于dag、任务、和时间点的组合。<br><br>它拥有运行状态：running、success、failed、skipped、up for retry等</p>
</blockquote>
<h3 id="1-10-Workflows"><a href="#1-10-Workflows" class="headerlink" title="1.10 Workflows"></a>1.10 Workflows</h3><blockquote>
<p>通过组合dags和operators，你会创建TaskInstances，你可以创建复杂的工作流。</p>
</blockquote>
<h1 id="2-Additional-Functionality"><a href="#2-Additional-Functionality" class="headerlink" title="2. Additional Functionality"></a>2. Additional Functionality</h1><h3 id="2-1-Hooks"><a href="#2-1-Hooks" class="headerlink" title="2.1 Hooks"></a>2.1 Hooks</h3><blockquote>
<p>Hooks是连接一些平台和数据库的接口，类似于 Hive, S3, MySQL, Postgres, HDFS, Pig。hooks尽可能的实现了通用接口，并且充当operator。还需要使用airflow.models.Connection 模型来检索主机名和身份认证信息，hooks将身份认证信息和代码放在管道之外，集中在元数据库中。</p>
</blockquote>
<h3 id="2-2-pools"><a href="#2-2-pools" class="headerlink" title="2.2 pools"></a>2.2 pools</h3><blockquote>
<p>一些系统会因为太多的进程不堪重负，airflow的pool可以被用作限制任意的task的运行。task可以在创建时通过参数指定存在的pool名称。<br><br>例如：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">aggregate_db_message_job = BashOperator(</span><br><span class="line">task_id=&apos;aggregate_db_message_job&apos;,</span><br><span class="line">execution_timeout=timedelta(hours=3),</span><br><span class="line">pool=&apos;ep_data_pipeline_db_msg_agg&apos;,</span><br><span class="line">bash_command=aggregate_db_message_job_cmd,</span><br><span class="line">dag=dag)</span><br><span class="line">aggregate_db_message_job.set_upstream(wait_for_empty_queue)</span><br></pre></td></tr></table></figure></p>
</blockquote>
<blockquote>
<p>pool中可以使用priority_weight参数去定义他的在队列中的权重，并且决定哪个task先行执行。<br><br>当容量被撑满时，task将会放入计划执行，一旦有容量，可运行的task和他们的状态将会被在前端展示，当插槽空闲，队列中的task将会基于权重进行排序执行。</p>
</blockquote>
<h3 id="2-3-Connections"><a href="#2-3-Connections" class="headerlink" title="2.3 Connections"></a>2.3 Connections</h3><blockquote>
<p>外部系统的connection信息被存储在airflow的元数据库中，airflow的管道可以很简单地引用被集中管理的conn_id,无需另外进行操作。<br><br>当许多的connections被定义在同一个conn_id下，在这种情况下，当hooks使用get_connection方法时，airflow将随机选择一个connection，当重试时允许一些基本的负载均衡和容错。<br><br>一些hooks有默认的conn_id，当operators使用这个hook时不需要一个明确的conn_id。例如：PostgresHook的默认conn_id是postgres_default</p>
</blockquote>
<h3 id="2-4-Queues"><a href="#2-4-Queues" class="headerlink" title="2.4 Queues"></a>2.4 Queues</h3><blockquote>
<p>当我们使用CeleryExecutor时，被塞入celery队列的task是可以被规定的，队列是BaseOperator的属性，所以任何task可以被分配到任何的队列中，而默认的队列环境是在配置文件的celery下的default_queue中配置的。<br><br>workers可以监听一个或多个队列中的task，当一个worker启动的时候（使用airflow worker命令），一个以逗号分隔的对列名可以被指定(airflow worker -q spark)，这个worker将只会选择那些被连接到指定对列的task。</p>
</blockquote>
<h3 id="2-5-XComs"><a href="#2-5-XComs" class="headerlink" title="2.5 XComs"></a>2.5 XComs</h3><blockquote>
<p>XComs使得tasks可以交换信息，允许更加细微的控制形式和分享状态。XComs原则上定义成key、value和timestamp，但是也可以跟踪一些属性，例如创建XCom的task/DAG。<br><br>XComs可以被pushed或者pulled，当一个task发送一个xcom，这个xcom是普遍可获得的。task可以被发送通过使用方法xcom_push()，此外，当一个task返回一个值时（不管是operators的execute()方法还是PythonOperators的python_callable方法），一个包含着返回值的xcom会自动发送。<br><br>tasks调用xcom_pull()去接受xcoms，可选择的根据key、task_ids、dag_id进行过滤。默认的，xcom_pull()在获得值时会根据keys自动筛选执行方法。<br><br>如果xcom_pull被传了一个task_id，则对应task最近一次的xcom值会被返回，如果一组task_ids传过去，会返回一组对应的xcom值<br><br>也可以直接在模板中获取xcom，例如：SELECT * FROM { { task_instance.xcom_pull(task_ids=’foo’, key=’table_name’) } }<br><br>值得注意的是，xcom与variable非常相似，但它是专门用于任务之间的通信而不是全局设置</p>
</blockquote>
<h3 id="2-6-Variables"><a href="#2-6-Variables" class="headerlink" title="2.6 Variables"></a>2.6 Variables</h3><blockquote>
<p>variables是一种传统的方式去存储和取回任意的内容或者是key-value形式的airflow的设置，它可以在前端界面、代码或者cli中进行增删改查的操作，当你定义管道代码，就可非常方便的使用，例如：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">from airflow.models import Variable</span><br><span class="line">foo = Variable.get(&quot;foo&quot;)</span><br><span class="line">bar = Variable.get(&quot;bar&quot;, deserialize_json=True)</span><br></pre></td></tr></table></figure></p>
</blockquote>
<blockquote>
<p>你可以使用variables在一个jinjia模板中：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &#123; &#123; var.value.&lt;variable_name&gt; &#125; &#125;</span><br></pre></td></tr></table></figure></p>
</blockquote>
<h3 id="2-7-Branching"><a href="#2-7-Branching" class="headerlink" title="2.7 Branching"></a>2.7 Branching</h3><blockquote>
<p>有时候你需要你的工作流进行分支，或者是根据任意上游发生的条件走某条路。这其中一种实现方法就是使用BranchPythonOperator<br><br>BranchPythonOperator和PythonOperator十分相似，除了python会期望一个python_callable去返回一个task_id，返回的task_id跳过所有其他路径，python的返回函数的task_id必须直接引用BranchPythonOperator任务下游的任务。<br></p>
</blockquote>
<p>注意，在BranchPythonOperator中使用depend_on_past = True下游的任务在逻辑上是不合理的，因为跳过状态总是导致依赖于过去成功的块任务。如果非要这样的话可以中间建立一个虚拟任务进行过度。</p>
<h3 id="2-8-SubDAGs"><a href="#2-8-SubDAGs" class="headerlink" title="2.8 SubDAGs"></a>2.8 SubDAGs</h3><h3 id="2-9-SLAs"><a href="#2-9-SLAs" class="headerlink" title="2.9 SLAs"></a>2.9 SLAs</h3><blockquote>
<p>记录失败的过错的sla任务列表</p>
</blockquote>
<h3 id="2-10-Trigger-Rules"><a href="#2-10-Trigger-Rules" class="headerlink" title="2.10 Trigger Rules"></a>2.10 Trigger Rules</h3><blockquote>
<p>虽然正常的工作流行为是在所有的直接上游任务成功之后触发的，但是airflow允许更为复杂的依赖项。<br><br>所有的operators有一个trigger_rule，用来定义生成的任务被触发的规则，trigger_rule的默认参数是all_success，以下为别的参数解释：<br><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">all_success: (default) 所有的父级任务成功</span><br><span class="line">all_failed: 所有的父级任务失败，或者上游状态为失败</span><br><span class="line">all_done: 所有的父级任务执行完成</span><br><span class="line">one_failed: 至少一个失败，并且不会等待所有任务执行完成</span><br><span class="line">one_success: 至少一个成功，并且不会等待所有任务执行完成</span><br><span class="line">dummy: 依赖只是为了展示，随意触发</span><br></pre></td></tr></table></figure></p>
</blockquote>
<p>注意，这些可以与depends_on_past结合使用，当设置为true时，如果任务的先前计划未成功，则不会触发</p>
<h3 id="2-11-Latest-Run-Only"><a href="#2-11-Latest-Run-Only" class="headerlink" title="2.11 Latest Run Only"></a>2.11 Latest Run Only</h3><blockquote>
<p>标准工作流行为涉及为特定日期/时间范围内运行的一系列任务，但是，某些工作流执行的任务与运行时间无关，但是需要按计划运行，就像标准的cron作业一样，在这些情况下，暂停期间错过的回填运行作业会浪费cpu周期。</p>
</blockquote>
<h3 id="2-12-Zombies-amp-Undeads"><a href="#2-12-Zombies-amp-Undeads" class="headerlink" title="2.12 Zombies &amp; Undeads"></a>2.12 Zombies &amp; Undeads</h3><blockquote>
<p>僵尸任务的特点是没有心跳（由工作定期发出）和数据库中的运行状态，当工作节点无法访问数据库的时候，airflow进程在外部被终止或者节点重启的时候，他们可能会发生。僵尸查杀由调度程序的进程定期执行。<br><br>undead进程的特点是存在进程和匹配的心跳，但是airflow不知道此任务在数据库中运行。这种不匹配通常在数据库状态发生改变的时候发生，最有可能是通过删除UI中的任务实例视图中的行，指示任务验证其作为心跳例程的一部分的状态，并在确定他们处于这种不死的状态时终止自身。</p>
</blockquote>
<h3 id="2-13-Cluster-Policy"><a href="#2-13-Cluster-Policy" class="headerlink" title="2.13 Cluster Policy"></a>2.13 Cluster Policy</h3><blockquote>
<p>你本地airflow设置文件可以定义一个策略功能，该功能可以根据其他任务或DAG属性改变其任务属性。</p>
</blockquote>
<h3 id="2-14-Documentation-amp-Notes"><a href="#2-14-Documentation-amp-Notes" class="headerlink" title="2.14 Documentation &amp; Notes"></a>2.14 Documentation &amp; Notes</h3><h3 id="2-15-Jinja-Templating"><a href="#2-15-Jinja-Templating" class="headerlink" title="2.15 Jinja Templating"></a>2.15 Jinja Templating</h3>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/12/09/celery/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="fengchuanling">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="枫川棂">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/12/09/celery/" itemprop="url">celery 安装及使用</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-12-09T18:25:50+08:00">
                2018-12-09
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/python-框架/" itemprop="url" rel="index">
                    <span itemprop="name">python-框架</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="1-centos7-下安装celery"><a href="#1-centos7-下安装celery" class="headerlink" title="1. centos7 下安装celery"></a>1. centos7 下安装celery</h1><h3 id="1-1-安装pip"><a href="#1-1-安装pip" class="headerlink" title="1.1 安装pip"></a>1.1 安装pip</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum -y install epel-release</span><br><span class="line">yum install python-pip</span><br></pre></td></tr></table></figure>
<h3 id="1-2-更新pip"><a href="#1-2-更新pip" class="headerlink" title="1.2 更新pip"></a>1.2 更新pip</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pip install --upgrade pip</span><br><span class="line">pip install --upgrade setuptools</span><br></pre></td></tr></table></figure>
<h3 id="1-3-安装celery"><a href="#1-3-安装celery" class="headerlink" title="1.3 安装celery"></a>1.3 安装celery</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install -U Celery</span><br></pre></td></tr></table></figure>
<h3 id="1-4-中间人安装，选择使用redis"><a href="#1-4-中间人安装，选择使用redis" class="headerlink" title="1.4 中间人安装，选择使用redis"></a>1.4 中间人安装，选择使用redis</h3><h4 id="1-4-1-安装redis"><a href="#1-4-1-安装redis" class="headerlink" title="1.4.1 安装redis"></a>1.4.1 安装redis</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">yum -y install redis</span><br><span class="line">vim /etc/redis.conf</span><br><span class="line">#bind 127.0.0.1     // 注释掉，使redis允许远程访问</span><br><span class="line">requirepass 密码  // 修改这行，redis登录密码</span><br></pre></td></tr></table></figure>
<h4 id="1-4-2-安装额外依赖"><a href="#1-4-2-安装额外依赖" class="headerlink" title="1.4.2 安装额外依赖"></a>1.4.2 安装额外依赖</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install -U celery[redis]</span><br></pre></td></tr></table></figure>
<h4 id="1-4-3-redis在celery下的使用配置"><a href="#1-4-3-redis在celery下的使用配置" class="headerlink" title="1.4.3 redis在celery下的使用配置"></a>1.4.3 redis在celery下的使用配置</h4><blockquote>
<p>1）使用配置，只需要设置redis的位置：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">例如：BROKER_URL = &apos;redis://localhost:6379/0&apos;</span><br><span class="line">格式解释：redis://:password@hostname:port/db_number</span><br></pre></td></tr></table></figure></p>
</blockquote>
<blockquote>
<p>2）可见性超时<br><br>可见性超时定义了等待职程在消息分派到其他程序之前确认收到任务的秒数<br>通过以下方式配置：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">BROKER_TRANSPORT_OPTIONS = &#123;&apos;visibility_timeout&apos;: 3600&#125;  // 默认为1小时</span><br></pre></td></tr></table></figure></p>
</blockquote>
<blockquote>
<p>这个时间会导致一种情况：任务循环重新执行；可以通过延长可见性时间来解决这个状况，例如<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">BROKER_TRANSPORT_OPTIONS = &#123;&apos;visibility_timeout&apos;: 43200&#125;</span><br></pre></td></tr></table></figure></p>
</blockquote>
<blockquote>
<p>3）存储任务的状态和返回值<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CELERY_RESULT_BACKEND = &apos;redis://localhost:6379/0&apos; 			//配置这个参数</span><br></pre></td></tr></table></figure></p>
</blockquote>
<blockquote>
<p>4）广播信息默认对所有虚拟主机可见，配置成只能被活跃的虚机接受<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">BROKER_TRANSPORT_OPTIONS = &#123;&apos;fanout_prefix&apos;: True&#125;</span><br></pre></td></tr></table></figure></p>
</blockquote>
<h1 id="2-celery-架构理解"><a href="#2-celery-架构理解" class="headerlink" title="2. celery 架构理解"></a>2. celery 架构理解</h1><p><img src="https://img2018.cnblogs.com/blog/1075630/201812/1075630-20181209154829362-1819648776.png" alt=""></p>
<h3 id="2-1-模块各功能"><a href="#2-1-模块各功能" class="headerlink" title="2.1 模块各功能"></a>2.1 模块各功能</h3><blockquote>
<p>1）任务生产者(task producer)<br><br>负责生产计算任务，交给消息队列进行处理。只要是调用了celery的api，我们都可以称为是任务生产者。<br><br>2）任务调度器(celery beat)<br><br>任务调度器是以独立的进程形式存在，它会读取配置文件的内容，周期性的将任务的请求发给任务队列。celery beat是celery自带的任务生产者，系统管理员可以选择关闭或者开启它，同事一个celery系统只能有一个celery beat调度器。<br><br>3）任务代理(broker)<br><br>任务代理方负责接收任务生产者发送过来的任务处理消息，存进队列之后再进行调度，分发给任务消费方。因为任务处理是基于message的，所以一般选择使用rabbitmq或者redis等消息队列或者数据库作为celery的message boker<br><br>4）任务消费方(celery worker)<br><br>celery worker就是执行任务的一方，它负责接收任务处理中间方发来的任务处理请求，完成这些任务，并且返回任务处理的结果。可多节点部署celery worker。<br><br>5）结果保存<br><br>celery支持任务处理完之后将状态信息和结果的保存，以供查询。<br></p>
</blockquote>
<h3 id="2-2-功能尝试"><a href="#2-2-功能尝试" class="headerlink" title="2.2 功能尝试"></a>2.2 功能尝试</h3><h4 id="2-1-1-任务生产者入口"><a href="#2-1-1-任务生产者入口" class="headerlink" title="2.1.1 任务生产者入口"></a>2.1.1 任务生产者入口</h4><p>1）创建celery对象<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">from celery import Celery</span><br><span class="line">import time</span><br><span class="line"></span><br><span class="line">app = Celery(&apos;notify_friends&apos;, backend=&apos;redis://:123123@localhost:6379/0&apos;,broker = &apos;redis://:123123@localhost:6379/0&apos;)</span><br><span class="line"></span><br><span class="line">@app.task</span><br><span class="line">def notify_friends(userId,newsId):</span><br><span class="line">        print &apos;Start at task at &#123;0&#125;, userId: &#123;1&#125;, newsId: &#123;2&#125; .&apos;.format(time.ctime(),userId,newsId)</span><br><span class="line">        time.sleep(2)</span><br><span class="line">        print &apos;Task notify_friends success at &#123;0&#125;&apos;.format(time.ctime())</span><br><span class="line">        return True</span><br></pre></td></tr></table></figure></p>
<p>2）启动celery worker<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">celery -A notify_friends worker --loglevel=info</span><br></pre></td></tr></table></figure></p>
<p>3）调用celery api<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">from notify_friends import notify_friends</span><br><span class="line">import time</span><br><span class="line"></span><br><span class="line">def notify(userId,newsId):</span><br><span class="line">        result = notify_friends.delay(userId,newsId)</span><br><span class="line">        while not result.ready():</span><br><span class="line">                time.sleep(1)</span><br><span class="line">                print result.get(timeout=10)</span><br><span class="line">if __name__ == &apos;__main__&apos;:</span><br><span class="line">        for i in range(10):</span><br><span class="line">                notify(&apos;root&apos;,str(i))</span><br></pre></td></tr></table></figure></p>
<p>2.1.2 任务调度器入口（定时任务调用celery api）<br>1）创建配置文件，定义schedule<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">from datetime import timedelta</span><br><span class="line"></span><br><span class="line">CELERYBEAT_SCHEDULE = &#123;</span><br><span class="line">        &apos;select_popular_book&apos;:&#123;</span><br><span class="line">                &apos;task&apos;: &apos;favourite_book.select_popular_book&apos;,</span><br><span class="line">                &apos;schedule&apos;: timedelta(seconds=10),</span><br><span class="line">        &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>2）创建celery对象，并且加载配置文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">from celery import Celery</span><br><span class="line">import time</span><br><span class="line"></span><br><span class="line">app = Celery(&apos;select_popular_book&apos;,backend=&apos;redis://:123123@localhost:6379/0&apos;,broker = &apos;redis://:123123@localhost:6379/0&apos;,)</span><br><span class="line">app.config_from_object(&apos;config&apos;)</span><br><span class="line"></span><br><span class="line">@app.task</span><br><span class="line">def select_popular_book():</span><br><span class="line">        print &apos;Start at &#123;0&#125;&apos;.format(time.ctime())</span><br><span class="line">        time.sleep(2)</span><br><span class="line">        print &apos;Task ... success at &#123;0&#125;&apos;.format(time.ctime())</span><br><span class="line">        return True</span><br></pre></td></tr></table></figure></p>
<p>3）启动celery worker<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">celery -A notify_friends worker --loglevel=info</span><br></pre></td></tr></table></figure></p>
<p>4）启动celery beat<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">celery -A favorite_book beat</span><br></pre></td></tr></table></figure></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/12/07/airflow3/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="fengchuanling">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="枫川棂">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/12/07/airflow3/" itemprop="url">airflow-api 插件的安装与使用介绍</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-12-07T17:54:29+08:00">
                2018-12-07
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/python-框架/" itemprop="url" rel="index">
                    <span itemprop="name">python-框架</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="1-安装插件airflow-rest-api"><a href="#1-安装插件airflow-rest-api" class="headerlink" title="1. 安装插件airflow-rest-api"></a>1. 安装插件<a href="https://github.com/teamclairvoyant/airflow-rest-api-plugin" target="_blank" rel="noopener">airflow-rest-api</a></h1><blockquote>
<p>1）获取<br><br><code>wget https://github.com/teamclairvoyant/airflow-rest-api-plugin/archive/master.zip</code><br><br>2）将plugin文件夹下的内容放入airflow/plugin/下，若不存在则新建<br><br>3）重启airflow</p>
</blockquote>
<h1 id="2-api使用介绍"><a href="#2-api使用介绍" class="headerlink" title="2. api使用介绍"></a>2. api使用介绍</h1><h3 id="2-1-获取airflow版本"><a href="#2-1-获取airflow版本" class="headerlink" title="2.1 获取airflow版本"></a>2.1 获取airflow版本</h3><blockquote>
<p>GET - http://{HOST}:{PORT}/admin/rest_api/api?api=version</p>
</blockquote>
<h3 id="2-2-获取airflow-api-plugin的版本"><a href="#2-2-获取airflow-api-plugin的版本" class="headerlink" title="2.2 获取airflow-api-plugin的版本"></a>2.2 获取airflow-api-plugin的版本</h3><blockquote>
<p>GET - http://{HOST}:{PORT}/admin/rest_api/api?api=rest_api_plugin_version</p>
</blockquote>
<h3 id="2-3-渲染任务实例模板"><a href="#2-3-渲染任务实例模板" class="headerlink" title="2.3 渲染任务实例模板"></a>2.3 渲染任务实例模板</h3><blockquote>
<p>GET - http://{HOST}:{PORT}/admin/rest_api/api?api=render<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">参数：</span><br><span class="line">1）dag_id</span><br><span class="line">2）task_id	任务id</span><br><span class="line">3）execution_date	dag的执行日期，例如：2017-01-02T03：04：05</span><br><span class="line">4）subdir(可选)	从中查找文件位置或目录</span><br></pre></td></tr></table></figure></p>
</blockquote>
<h3 id="2-4-操作变量"><a href="#2-4-操作变量" class="headerlink" title="2.4 操作变量"></a>2.4 操作变量</h3><blockquote>
<p>GET - http://{HOST}:{PORT}/admin/rest_api/api?api=variables<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">参数(均为可选参数)：</span><br><span class="line">1）set：设置变量，key value</span><br><span class="line">2）get：获取变量</span><br><span class="line">3）json：布尔值，反序列化json</span><br><span class="line">4）default：如果变量不存在，则返回默认值</span><br><span class="line">5）import：从json文件导入变量</span><br><span class="line">6）export：从json文件导出变量</span><br><span class="line">7）delete：删除变量</span><br></pre></td></tr></table></figure></p>
</blockquote>
<h3 id="2-5-操作连接"><a href="#2-5-操作连接" class="headerlink" title="2.5 操作连接"></a>2.5 操作连接</h3><blockquote>
<p>GET - http://{HOST}:{PORT}/admin/rest_api/api?api=connections<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">参数(均为可选参数)：</span><br><span class="line">1）list：布尔型，列出所有连接</span><br><span class="line">2）add：增加连接</span><br><span class="line">3）delete：布尔型，删除连接</span><br><span class="line">4）conn_id：添加/删除连接所需要的连接id</span><br><span class="line">5）conn_id：添加连接所需要的连接url</span><br><span class="line">6）conn_extra：连接的额外字段，添加连接时可选参数</span><br></pre></td></tr></table></figure></p>
</blockquote>
<h3 id="2-6-暂停DAG"><a href="#2-6-暂停DAG" class="headerlink" title="2.6 暂停DAG"></a>2.6 暂停DAG</h3><blockquote>
<p>GET - http://{HOST}:{PORT}/admin/rest_api/api?api=pause<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">参数：</span><br><span class="line">1）dag_id</span><br><span class="line">2）subdir：可选参数，从中查找dag的文件位置或者目录</span><br></pre></td></tr></table></figure></p>
</blockquote>
<h3 id="2-7-继续dag"><a href="#2-7-继续dag" class="headerlink" title="2.7 继续dag"></a>2.7 继续dag</h3><blockquote>
<p>GET - http://{HOST}:{PORT}/admin/rest_api/api?api=unpause<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">参数：</span><br><span class="line">1）dag_id</span><br><span class="line">2）subdir：可选参数，从中查找dag的文件位置或者目录</span><br></pre></td></tr></table></figure></p>
</blockquote>
<h3 id="2-8-调度任务失败的依赖"><a href="#2-8-调度任务失败的依赖" class="headerlink" title="2.8 调度任务失败的依赖"></a>2.8 调度任务失败的依赖</h3><blockquote>
<p>GET - http://{HOST}:{PORT}/admin/rest_api/api?api=task_failed_deps<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">参数：</span><br><span class="line">1）dag_id</span><br><span class="line">2）task_id</span><br><span class="line">3）execution_date</span><br><span class="line">4）subdir：可选</span><br></pre></td></tr></table></figure></p>
</blockquote>
<h3 id="2-9-触发dag运行"><a href="#2-9-触发dag运行" class="headerlink" title="2.9 触发dag运行"></a>2.9 触发dag运行</h3><blockquote>
<p>GET - http://{HOST}:{PORT}/admin/rest_api/api?api=trigger_dag<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">参数：</span><br><span class="line">1）dag_id</span><br><span class="line">2）run_id：可选参数，用于dag运行的runid</span><br><span class="line">3）conf：可选参数，传递给触发dag运行的一些配置，（URL Encoded JSON）以&#123;&quot;key&quot;:&quot;value&quot;&#125;的形式</span><br></pre></td></tr></table></figure></p>
</blockquote>
<h3 id="2-10-测试任务实例，但是不检查依赖或者在数据库中记录"><a href="#2-10-测试任务实例，但是不检查依赖或者在数据库中记录" class="headerlink" title="2.10 测试任务实例，但是不检查依赖或者在数据库中记录"></a>2.10 测试任务实例，但是不检查依赖或者在数据库中记录</h3><blockquote>
<p>GET - http://{HOST}:{PORT}/admin/rest_api/api?api=test<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">参数：</span><br><span class="line">1）dag_id</span><br><span class="line">2）task_id</span><br><span class="line">3）execution_date</span><br><span class="line">4）subdir：可选参数</span><br><span class="line">5）dryrun：可选参数，布尔型，是否进行干运行</span><br><span class="line">6）task_params：可选参数，将json字典传给task</span><br></pre></td></tr></table></figure></p>
</blockquote>
<h3 id="2-11-获取dag运行状态"><a href="#2-11-获取dag运行状态" class="headerlink" title="2.11 获取dag运行状态"></a>2.11 获取dag运行状态</h3><blockquote>
<p>GET - http://{HOST}:{PORT}/admin/rest_api/api?api=dag_state<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">参数：</span><br><span class="line">1）dag_id</span><br><span class="line">2）execution_date</span><br><span class="line">3）subdir：可选参数</span><br></pre></td></tr></table></figure></p>
</blockquote>
<h3 id="2-12-运行单个task实例"><a href="#2-12-运行单个task实例" class="headerlink" title="2.12 运行单个task实例"></a>2.12 运行单个task实例</h3><blockquote>
<p>GET - http://{HOST}:{PORT}/admin/rest_api/api?api=run<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">参数：</span><br><span class="line">1）dag_id</span><br><span class="line">2）task_id</span><br><span class="line">3）execution_date</span><br><span class="line">4）subdir：可选参数</span><br><span class="line">5）mark_success：可选参数，布尔型，不运行jobs但是标记为成功</span><br><span class="line">6）force：可选参数，布尔型，忽略先前的运行状态，无论任务是否成功都重新运行</span><br><span class="line">7）pool：可选参数，资源池</span><br><span class="line">8）cfg_path：可选参数，使用配置文件的路径而不用原有的airflow.cfg</span><br><span class="line">9）local：可选参数，布尔值，使用localexecute运行任务</span><br><span class="line">10）ignore_all_dependencies：可选参数，布尔值，忽略所有的非关键依赖项，包括ignore_ti_state和ignore_task_depsstore_true</span><br><span class="line">11）ignore_dependencies：可选，布尔值，忽略特定于任务的依赖关系，例如upstream, depends_on_past还有retry delay dependencies</span><br><span class="line">12）ignore_depends_on_past：可选，布尔值，忽略depends_on_past依赖项，但是尊重上游</span><br><span class="line">13）ship_dag：可选，布尔值，序列化dag并发送给worker</span><br><span class="line">14）pickle：可选：整个dag的序列化pickle对象</span><br></pre></td></tr></table></figure></p>
</blockquote>
<h3 id="2-13-某个dag的所有tasks"><a href="#2-13-某个dag的所有tasks" class="headerlink" title="2.13 某个dag的所有tasks"></a>2.13 某个dag的所有tasks</h3><blockquote>
<p>GET - http://{HOST}:{PORT}/admin/rest_api/api?api=list_tasks<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">参数：</span><br><span class="line">1）dag_id</span><br><span class="line">2）tree：可选参数，布尔型</span><br><span class="line">3）subdir：可选参数</span><br></pre></td></tr></table></figure></p>
</blockquote>
<h3 id="2-14-在制定范围内运行dag的子部分"><a href="#2-14-在制定范围内运行dag的子部分" class="headerlink" title="2.14 在制定范围内运行dag的子部分"></a>2.14 在制定范围内运行dag的子部分</h3><blockquote>
<p>GET - http://{HOST}:{PORT}/admin/rest_api/api?api=backfill<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">参数：</span><br><span class="line">1）dag_id</span><br><span class="line">2）task_regex：可选参数，用于过滤特定的task_ids以进行回填正则表达式</span><br><span class="line">3）start_date：覆盖start_date YYYY-MM-DD</span><br><span class="line">4）end_date：可选参数，同上覆盖</span><br><span class="line">5）mark_success：可选参数，布尔型，不运行jobs但是标记为成功</span><br><span class="line">6）local：可选参数，布尔型，使用LocalExecutor运行任务</span><br><span class="line">7）donot_pickle：可选参数，不进行尝试将dag对象发给工作人员，只告诉他们dag的运行版本</span><br><span class="line">8）include_adhoc：可选参数，布尔值，包含带有adhoc参数的dags</span><br><span class="line">9）ignore_dependencies：可选参数，布尔值，忽略特定于任务的依赖关系，例如 upstream, depends_on_past, and retry delay dependencies</span><br><span class="line">10）ignore_first_depends_on_past：可选参数，布尔值，仅忽略第一组任务的depends_on_past依赖关系</span><br><span class="line">11）subdir：可选参数，</span><br><span class="line">12）pool：可选参数，资源池</span><br><span class="line">13）dry_run：可选参数，布尔值，是否空运行</span><br></pre></td></tr></table></figure></p>
</blockquote>
<h3 id="2-15-列出所有的dags"><a href="#2-15-列出所有的dags" class="headerlink" title="2.15 列出所有的dags"></a>2.15 列出所有的dags</h3><blockquote>
<p>GET - http://{HOST}:{PORT}/admin/rest_api/api?api=list_dags<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">参数：	</span><br><span class="line">1）subdir：可选参数</span><br><span class="line">2）report：可选参数，布尔型，显示dagbag的加载报告</span><br></pre></td></tr></table></figure></p>
</blockquote>
<h3 id="2-16-启动kerberos票证续订"><a href="#2-16-启动kerberos票证续订" class="headerlink" title="2.16 启动kerberos票证续订"></a>2.16 启动kerberos票证续订</h3><blockquote>
<p>GET - http://{HOST}:{PORT}/admin/rest_api/api?api=kerberos<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">参数（均为可选参数）：</span><br><span class="line">1）principal</span><br><span class="line">2）keytab</span><br><span class="line">3）pid：pid文件位置</span><br><span class="line">4）daemon：布尔值，是否为守护进程</span><br><span class="line">5）stdout：将stdout重定向到文件</span><br><span class="line">6）stderr：将错误重定向到文件</span><br><span class="line">7）log-file：日志文件</span><br></pre></td></tr></table></figure></p>
</blockquote>
<h3 id="2-17-启动celery工作节点（worker）"><a href="#2-17-启动celery工作节点（worker）" class="headerlink" title="2.17 启动celery工作节点（worker）"></a>2.17 启动celery工作节点（worker）</h3><blockquote>
<p>GET - http://{HOST}:{PORT}/admin/rest_api/api?api=worker<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">参数（均为可选参数）：</span><br><span class="line">1）do_pickle：布尔型，尝试picklg DAG对象发送给worker，而不是让worker运行他们的代码版本</span><br><span class="line">2）queues：逗号分隔的队列列表</span><br><span class="line">3）concurrency：工作进程数</span><br><span class="line">4）pid：pid文件位置</span><br><span class="line">5）daemon：布尔值，是否为守护进程</span><br><span class="line">6）stdout：将stdout重定向到文件</span><br><span class="line">7）stderr：将错误重定向到文件</span><br><span class="line">8）log-file：日志文件</span><br></pre></td></tr></table></figure></p>
</blockquote>
<h3 id="2-18-启动celery工作节点（flower）"><a href="#2-18-启动celery工作节点（flower）" class="headerlink" title="2.18 启动celery工作节点（flower）"></a>2.18 启动celery工作节点（flower）</h3><blockquote>
<p>GET - http://{HOST}:{PORT}/admin/rest_api/api?api=flower<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">参数（均为可选参数）：</span><br><span class="line">1）hostname：设置运行服务器的主机名</span><br><span class="line">2）port：运行服务器的端口</span><br><span class="line">3）flower_conf：flower的配置文件</span><br><span class="line">4）broker_api</span><br><span class="line">5）pid：pid文件位置</span><br><span class="line">6）daemon：布尔值，是否为守护进程</span><br><span class="line">7）stdout：将stdout重定向到文件</span><br><span class="line">8）stderr：将错误重定向到文件</span><br><span class="line">9）log-file：日志文件</span><br></pre></td></tr></table></figure></p>
</blockquote>
<h3 id="2-19-启动调度程序实例"><a href="#2-19-启动调度程序实例" class="headerlink" title="2.19 启动调度程序实例"></a>2.19 启动调度程序实例</h3><blockquote>
<p>GET - http://{HOST}:{PORT}/admin/rest_api/api?api=scheduler<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">参数（均为可选参数）：</span><br><span class="line">1）dag_id</span><br><span class="line">2）subdir：可选参数，从中查找dag的文件位置或者目录</span><br><span class="line">3）run-duration：设置退出前执行的秒数</span><br><span class="line">4）num_runs：设置退出前执行的次数</span><br><span class="line">5）do_pickle：布尔型，尝试pickle DAG对象发送给worker，而不是让worker运行他们的代码版本</span><br><span class="line">6）pid：pid文件位置</span><br><span class="line">7）daemon：布尔值，是否为守护进程</span><br><span class="line">8）stdout：将stdout重定向到文件</span><br><span class="line">9）stderr：将错误重定向到文件</span><br><span class="line">10）log-file：日志文件</span><br></pre></td></tr></table></figure></p>
</blockquote>
<h3 id="2-20-获取task的运行状态"><a href="#2-20-获取task的运行状态" class="headerlink" title="2.20 获取task的运行状态"></a>2.20 获取task的运行状态</h3><blockquote>
<p>GET - http://{HOST}:{PORT}/admin/rest_api/api?api=task_state<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">参数：</span><br><span class="line">1）dag_id</span><br><span class="line">2）task_id</span><br><span class="line">3）execution_date</span><br><span class="line">4）subdir：可选</span><br></pre></td></tr></table></figure></p>
</blockquote>
<h3 id="2-21-CRUD-对pool的操作"><a href="#2-21-CRUD-对pool的操作" class="headerlink" title="2.21 CRUD 对pool的操作"></a>2.21 CRUD 对pool的操作</h3><blockquote>
<p>GET - http://{HOST}:{PORT}/admin/rest_api/api?api=pool<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">参数：</span><br><span class="line">1）set：分别设置池插槽计数和描述。 表单中的预期输入：NAME SLOT_COUNT POOL_DESCRIPTION</span><br><span class="line">2）get：获取池信息</span><br><span class="line">3）delete：删除池</span><br></pre></td></tr></table></figure></p>
</blockquote>
<h3 id="2-22-由worker生成的日志"><a href="#2-22-由worker生成的日志" class="headerlink" title="2.22 由worker生成的日志"></a>2.22 由worker生成的日志</h3><blockquote>
<p>GET - http://{HOST}:{PORT}/admin/rest_api/api?api=serve_logs<br><br>参数：无</p>
</blockquote>
<h3 id="2-23-清除一组任务实例"><a href="#2-23-清除一组任务实例" class="headerlink" title="2.23 清除一组任务实例"></a>2.23 清除一组任务实例</h3><blockquote>
<p>GET - http://{HOST}:{PORT}/admin/rest_api/api?api=clear<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">参数：</span><br><span class="line">1）dag_id</span><br><span class="line">2）task_regex：可选参数，用于过滤特定的task_ids以进行回填正则表达式</span><br><span class="line">3）start_date：覆盖start_date YYYY-MM-DD</span><br><span class="line">4）end_date：可选参数，同上覆盖</span><br><span class="line">5）subdir：可选参数</span><br><span class="line">6）upstream：可选，布尔型，包含上游任务</span><br><span class="line">7）downstream：可选，布尔型，包含下游任务</span><br><span class="line">8）no_confirm：可选，布尔型，不要求确认</span><br><span class="line">9）only_failed：可选，布尔型，仅失败的作业</span><br><span class="line">10）only_running：可选，布尔型，仅运行的作业</span><br><span class="line">11）exclude_subdags：可选，布尔型，排除子标记</span><br></pre></td></tr></table></figure></p>
</blockquote>
<h3 id="2-24-发布一个新的dag"><a href="#2-24-发布一个新的dag" class="headerlink" title="2.24 发布一个新的dag"></a>2.24 发布一个新的dag</h3><blockquote>
<p>POST - http://{HOST}:{PORT}/admin/rest_api/api?api=deploy_dag<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">post参数：</span><br><span class="line">1）dag_file：file-上传部署的py文件</span><br><span class="line">2）force：可选，布尔型，文件已存在，是否强制上传</span><br><span class="line">3）pause：可选，布尔型，在创建时强制暂停dag并覆盖&apos;dags_are_paused_at_creation&apos;配置</span><br><span class="line">4）unpause（可选） - 布尔值 -  DAG在创建时将被强制取消暂停，并覆盖&apos;dags_are_paused_at_creation&apos;配置</span><br></pre></td></tr></table></figure></p>
</blockquote>
<h3 id="2-25-刷新一个dag"><a href="#2-25-刷新一个dag" class="headerlink" title="2.25 刷新一个dag"></a>2.25 刷新一个dag</h3><blockquote>
<p>GET - http://{HOST}:{PORT}/admin/rest_api/api?api=refresh_dag<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">参数：	</span><br><span class="line">1）dag_id</span><br></pre></td></tr></table></figure></p>
</blockquote>
<h1 id="3-api响应参数："><a href="#3-api响应参数：" class="headerlink" title="3. api响应参数："></a>3. api响应参数：</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">airflow_cmd  - 字符串 - 在本地计算机上运行Airflow CLI命令</span><br><span class="line">arguments  -  Dict  - 包含您传入的参数的字典及其值</span><br><span class="line">post_arguments  -  Dict  - 包含您传入的帖子身体参数及其值的字典</span><br><span class="line">call_time  - 时间戳 - 服务器接收请求的时间</span><br><span class="line">output  -  String  - 调用CLI函数的文本输出</span><br><span class="line">response_time  - 时间戳 - 服务器发回响应的时间</span><br><span class="line">status  - 字符串 - 响应呼叫的状态。 （可能的值：OK，ERROR）</span><br><span class="line">warning  -  String  - 从API发回的警告消息</span><br><span class="line">http_response_code  - 整数 -  HTTP响应代码</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/12/03/mariadb/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="fengchuanling">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="枫川棂">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/12/03/mariadb/" itemprop="url">centos7 更新mariadb</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-12-03T18:49:43+08:00">
                2018-12-03
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/linux/" itemprop="url" rel="index">
                    <span itemprop="name">linux</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="1-备份数据库内容"><a href="#1-备份数据库内容" class="headerlink" title="1. 备份数据库内容"></a>1. 备份数据库内容</h2><pre><code>mysqldump -uroot -p --all-databases &gt; /opt/database-dump.sql
</code></pre><h2 id="2-停止mysql并清除（前提是备份好数据库内容）"><a href="#2-停止mysql并清除（前提是备份好数据库内容）" class="headerlink" title="2. 停止mysql并清除（前提是备份好数据库内容）"></a>2. 停止mysql并清除（前提是备份好数据库内容）</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl stop mariadb</span><br><span class="line">yum remove mariadb mariadb-server mariadb-libs</span><br></pre></td></tr></table></figure>
<h2 id="3-添加mariadb下载源"><a href="#3-添加mariadb下载源" class="headerlink" title="3. 添加mariadb下载源"></a>3. 添加mariadb下载源</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/yum.repos.d/mariadb.repo</span><br><span class="line">  [mariadb]</span><br><span class="line"> name = MariaDB</span><br><span class="line"> baseurl = http://yum.mariadb.org/10.2/centos7-amd64</span><br><span class="line"> gpgkey=https://yum.mariadb.org/RPM-GPG-KEY-MariaDB</span><br><span class="line"> gpgcheck=1</span><br></pre></td></tr></table></figure>
<h2 id="4-清理yum缓存"><a href="#4-清理yum缓存" class="headerlink" title="4. 清理yum缓存"></a>4. 清理yum缓存</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum clean all</span><br></pre></td></tr></table></figure>
<h2 id="5-下载"><a href="#5-下载" class="headerlink" title="5. 下载"></a>5. 下载</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install MariaDB-client MariaDB-server</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/12/03/airflow2/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="fengchuanling">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="枫川棂">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/12/03/airflow2/" itemprop="url">airflow 文档学习(一) 基本Operator</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-12-03T17:47:06+08:00">
                2018-12-03
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/python-框架/" itemprop="url" rel="index">
                    <span itemprop="name">python-框架</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="1-Operator和task"><a href="#1-Operator和task" class="headerlink" title="1. Operator和task"></a>1. Operator和task</h1><blockquote>
<p>简单来说，Operator就是task的抽象类</p>
</blockquote>
<h1 id="2-BaseOperator"><a href="#2-BaseOperator" class="headerlink" title="2. BaseOperator"></a>2. BaseOperator</h1><blockquote>
<p>所有的功能性Operator的来源</p>
</blockquote>
<h3 id="2-1-参数："><a href="#2-1-参数：" class="headerlink" title="2.1 参数："></a>2.1 参数：</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">task_id (string) ：唯一标识task的id</span><br><span class="line">owner (string)</span><br><span class="line">retries (int)：任务重试此时</span><br><span class="line">retry_delay (timedelta) ：重试间隔</span><br><span class="line">start_date (datetime)：任务开始时间，第一个任务实例的执行时间</span><br><span class="line">end_date (datetime)：如果指定的话，任务执行不会超过这个时间</span><br><span class="line">depends_on_past (bool)：如果指定的话，任务实例将以此运行并且依赖上一个任务的成功</span><br><span class="line">wait_for_downstream (bool)：在这个参数指定的任何地方，depends_on_past都将强制为true</span><br><span class="line">queue(str)：指定到队列，CeleryExcutor指定特定队列</span><br><span class="line">dag(DAG)：指定dag</span><br><span class="line">pool(str)：此任务运行的插槽池，限制任务的并发</span><br><span class="line">execution_timeout (datetime.timedelta)：执行此任务实例允许的最长时间，超过最长时间则任务失败</span><br><span class="line">sla(datetime.timedelta)：作业预计成功时间</span><br><span class="line">on_failure_callback(callable)：当此任务实例失败时调用的函数</span><br><span class="line">on_retry_callback (callable) ：与on_failure_callback相似，只是重试任务时触发</span><br><span class="line">on_success_callback (callable) ：与on_failure_callback相似，任务成功时触发</span><br><span class="line">trigger_rule (str)：定义依赖的触发规则</span><br><span class="line">  ·包括的选项有：&#123;all_success | all_failed | all_done | one_success | one_failed | dummy&#125;，默认为all_success</span><br><span class="line">run_as_user(str)：在运行任务时使用unix用户名进行模拟</span><br><span class="line">executor_config (dict)：特定的执行程序解释其任务参数</span><br><span class="line">task_concurrency (int)：设置后，任务将限制execution_dates之间的并发运行</span><br><span class="line">resources (dict)：资源参数名称（Resources构造函数的参数名称）与其值的映射。</span><br><span class="line">priority_weight(int)：此任务的优先级权重</span><br><span class="line">weight_rule(str)：用于任务的有效总优先级权重的加权方法</span><br><span class="line">max_retry_delay (timedelta)：重试最大延迟间隔</span><br><span class="line">retry_exponential_backoff (bool)</span><br></pre></td></tr></table></figure>
<h3 id="2-2-方法"><a href="#2-2-方法" class="headerlink" title="2.2 方法"></a>2.2 方法</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">set_downstream(task_or_task_list)</span><br><span class="line">将任务或者任务列表设置为当前任务的下游</span><br><span class="line">set_upstream(task_or_task_list)</span><br><span class="line">将任务或者任务列表设置为当前任务的上游</span><br><span class="line"></span><br><span class="line">clear(start_date=None, end_date=None, upstream=False, downstream=False, session=None)</span><br><span class="line">根据指定参数清除与任务关联的任务实例的状态</span><br><span class="line">execute(context)</span><br><span class="line">创建operator时派生的主要方法</span><br><span class="line">get_direct_relative_ids(upstream=False)</span><br><span class="line">获取当前任务上游或者下游的直接相对id</span><br><span class="line">get_direct_relatives(upstream=False)</span><br><span class="line">获取当前任务的上游或者下游直接关联对象</span><br><span class="line">get_flat_relative_ids(upstream=False, found_descendants=None)</span><br><span class="line">获取上游或者下游的关联对象的id列表</span><br><span class="line">get_flat_relatives(upstream=False)</span><br><span class="line">获取上游或者下游的关联对象列表</span><br><span class="line">get_task_instances(session, start_date=None, end_date=None)</span><br><span class="line">获取特定时间范围的与此任务相关的任务实例</span><br><span class="line">has_dag()</span><br><span class="line">是否设置dag</span><br><span class="line">on_kill()</span><br><span class="line">当任务实例被杀死时，重写方法以清除子进程</span><br><span class="line">run(start_date=None, end_date=None, ignore_first_depends_on_past=False, ignore_ti_state=False, mark_success=False)</span><br><span class="line">为日期范围运行一组任务实例</span><br><span class="line">post_execute(context, result=None)</span><br><span class="line">调用self.execute()后立即触发，它传递上下文和operator返回的结果</span><br><span class="line">pre_execute(context)</span><br><span class="line">调用self.execute()之前触发</span><br><span class="line">prepare_template()</span><br><span class="line">模板化字段被其内容替换之后触发</span><br><span class="line">render_template(attr, content, context)</span><br><span class="line">从文件或直接在字段中呈现模板，并返回呈现结果</span><br><span class="line">render_template_from_field(attr, content, context, jinja_env)</span><br><span class="line">从字段中呈现模板</span><br><span class="line">xcom_pull(context, task_ids=None, dag_id=None, key=&apos;return_value&apos;, include_prior_dates=None)</span><br><span class="line">xcom_push(context, key, value, execution_date=None)</span><br></pre></td></tr></table></figure>
<h3 id="2-3-可调用值"><a href="#2-3-可调用值" class="headerlink" title="2.3 可调用值"></a>2.3 可调用值</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">dag：如果设置了则返回dag，否则报错</span><br><span class="line">deps：返回依赖任务列表</span><br><span class="line">downstream_list：下游任务列表</span><br><span class="line">schedule_interval：任务排列</span><br><span class="line">upstream_list：上游任务列表</span><br></pre></td></tr></table></figure>
<h1 id="3-BaseSensorOperator"><a href="#3-BaseSensorOperator" class="headerlink" title="3. BaseSensorOperator"></a>3. BaseSensorOperator</h1><blockquote>
<p>基于 airflow.models.BaseOperator, airflow.models.SkipMixin</p>
</blockquote>
<h3 id="3-1-参数："><a href="#3-1-参数：" class="headerlink" title="3.1 参数："></a>3.1 参数：</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">soft_fail (bool)：设置为true以将任务标记为失败时的skipped</span><br><span class="line">poke_interval (int)：作业在每次尝试之间应等待的时间（单位：秒）</span><br><span class="line">timeout (int)：超时时间</span><br></pre></td></tr></table></figure>
<h3 id="3-2-方法："><a href="#3-2-方法：" class="headerlink" title="3.2 方法："></a>3.2 方法：</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">execute(context)</span><br><span class="line">poke(context)</span><br></pre></td></tr></table></figure>
<h1 id="4-Core-Operators"><a href="#4-Core-Operators" class="headerlink" title="4. Core Operators"></a>4. Core Operators</h1><h3 id="4-1-airflow-sensors-base-sensor-operator-BaseSensorOperator-poke-interval-60-timeout-604800-soft-fail-False-args-kwargs"><a href="#4-1-airflow-sensors-base-sensor-operator-BaseSensorOperator-poke-interval-60-timeout-604800-soft-fail-False-args-kwargs" class="headerlink" title="4.1 airflow.sensors.base_sensor_operator.BaseSensorOperator(poke_interval=60, timeout=604800, soft_fail=False, *args, **kwargs)"></a>4.1 airflow.sensors.base_sensor_operator.BaseSensorOperator(poke_interval=60, timeout=604800, soft_fail=False, *args, **kwargs)</h3><blockquote>
<p>基于 airflow.models.BaseOperator</p>
</blockquote>
<h4 id="4-1-1-参数："><a href="#4-1-1-参数：" class="headerlink" title="4.1.1 参数："></a>4.1.1 参数：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">bash_command (string)：bash命令</span><br><span class="line">xcom_push (bool)：设置为true，则当bash命令完成之后，写入stdout的最后一行也会被推送到xcom</span><br><span class="line">env (dict)：如果不为None的话，则它定义新进程的环境变量的映射，用于替代当前的进程环境</span><br></pre></td></tr></table></figure>
<h4 id="4-1-2-方法："><a href="#4-1-2-方法：" class="headerlink" title="4.1.2 方法："></a>4.1.2 方法：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">execute(context)</span><br><span class="line">会在临时目录中执行bash，并且之后会对其进行清理</span><br><span class="line">on_kill()</span><br><span class="line">同BaseOperator</span><br></pre></td></tr></table></figure>
<h3 id="4-2-airflow-operators-bash-operator-BashOperator-bash-command-xcom-push-False-env-None-output-encoding-’utf-8’-args-kwargs"><a href="#4-2-airflow-operators-bash-operator-BashOperator-bash-command-xcom-push-False-env-None-output-encoding-’utf-8’-args-kwargs" class="headerlink" title="4.2 airflow.operators.bash_operator.BashOperator(bash_command, xcom_push=False, env=None, output_encoding=’utf-8’, *args, **kwargs)"></a>4.2 airflow.operators.bash_operator.BashOperator(bash_command, xcom_push=False, env=None, output_encoding=’utf-8’, *args, **kwargs)</h3><blockquote>
<p>基于 airflow.operators.python_operator.PythonOperator, airflow.models.SkipMixin</p>
</blockquote>
<h3 id="4-3-airflow-operators-python-operator-BranchPythonOperator-python-callable-op-args-None-op-kwargs-None-provide-context-False-templates-dict-None-templates-exts-None-args-kwargs"><a href="#4-3-airflow-operators-python-operator-BranchPythonOperator-python-callable-op-args-None-op-kwargs-None-provide-context-False-templates-dict-None-templates-exts-None-args-kwargs" class="headerlink" title="4.3 airflow.operators.python_operator.BranchPythonOperator(python_callable, op_args=None, op_kwargs=None, provide_context=False, templates_dict=None, templates_exts=None, *args, **kwargs)"></a>4.3 airflow.operators.python_operator.BranchPythonOperator(python_callable, op_args=None, op_kwargs=None, provide_context=False, templates_dict=None, templates_exts=None, *args, **kwargs)</h3><blockquote>
<p>基于 airflow.operators.python_operator.PythonOperator, airflow.models.SkipMixin</p>
</blockquote>
<h3 id="4-4-airflow-operators-check-operator-CheckOperator-sql-conn-id-None-args-kwargs"><a href="#4-4-airflow-operators-check-operator-CheckOperator-sql-conn-id-None-args-kwargs" class="headerlink" title="4.4 airflow.operators.check_operator.CheckOperator(sql, conn_id=None, *args, **kwargs)"></a>4.4 airflow.operators.check_operator.CheckOperator(sql, conn_id=None, *args, **kwargs)</h3><blockquote>
<p>基于 airflow.models.BaseOperator<br><br>CheckOperator需要返回一个单行的sql查询，第一行的每个值都需要使用python bool cast进行计算，如果任何返回值false，则检查失败并输出错误</p>
</blockquote>
<h4 id="4-4-1-注意："><a href="#4-4-1-注意：" class="headerlink" title="4.4.1 注意："></a>4.4.1 注意：</h4><blockquote>
<p>1）python bool cast 会将一下视作false：<br><br>&emsp;False<br><br>&emsp;0<br><br>&emsp;Empty string (“”)<br><br>&emsp;Empty list ([])<br><br>&emsp;Empty dictionary or set ({})<br><br>2）这是一个抽象类，需要定义get_db_hook，而get_db_hook是钩子，从外部获取单个记录</p>
</blockquote>
<h4 id="4-4-2-参数："><a href="#4-4-2-参数：" class="headerlink" title="4.4.2 参数："></a>4.4.2 参数：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sql (string)：执行的sql语句</span><br></pre></td></tr></table></figure>
<h3 id="4-5-airflow-operators-email-operator-EmailOperator-to-subject-html-content-files-None-cc-None-bcc-None-mime-subtype-’mixed’-mime-charset-’us-ascii’-args-kwargs"><a href="#4-5-airflow-operators-email-operator-EmailOperator-to-subject-html-content-files-None-cc-None-bcc-None-mime-subtype-’mixed’-mime-charset-’us-ascii’-args-kwargs" class="headerlink" title="4.5 airflow.operators.email_operator.EmailOperator(to, subject, html_content, files=None, cc=None, bcc=None, mime_subtype=’mixed’, mime_charset=’us_ascii’, *args, **kwargs)"></a>4.5 airflow.operators.email_operator.EmailOperator(to, subject, html_content, files=None, cc=None, bcc=None, mime_subtype=’mixed’, mime_charset=’us_ascii’, *args, **kwargs)</h3><blockquote>
<p>基于 airflow.models.BaseOperator<br><br>功能：发送一封邮件</p>
</blockquote>
<h4 id="4-5-1-参数："><a href="#4-5-1-参数：" class="headerlink" title="4.5.1 参数："></a>4.5.1 参数：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">to (list or string (comma or semicolon delimited))：发送电子邮件的邮件列表</span><br><span class="line">subject (string)：邮件主题</span><br><span class="line">html_content (string)：邮件内容（允许html标记）</span><br><span class="line">files (list)：附件名称</span><br><span class="line">cc (list or string (comma or semicolon delimited))：抄送列表</span><br><span class="line">bcc (list or string (comma or semicolon delimited))：bcc列表</span><br><span class="line">mime_subtype (string)：MIME字内容类型</span><br><span class="line">mime_charset (string)：字符集参数添加到 Content-Type 头部</span><br></pre></td></tr></table></figure>
<h3 id="4-6-airflow-operators-mysql-operator-MySqlOperator-sql-mysql-conn-id-’mysql-default’-parameters-None-autocommit-False-database-None-args-kwargs"><a href="#4-6-airflow-operators-mysql-operator-MySqlOperator-sql-mysql-conn-id-’mysql-default’-parameters-None-autocommit-False-database-None-args-kwargs" class="headerlink" title="4.6 airflow.operators.mysql_operator.MySqlOperator(sql, mysql_conn_id=’mysql_default’, parameters=None, autocommit=False, database=None, *args, **kwargs)"></a>4.6 airflow.operators.mysql_operator.MySqlOperator(sql, mysql_conn_id=’mysql_default’, parameters=None, autocommit=False, database=None, *args, **kwargs)</h3><blockquote>
<p>基于 airflow.models.BaseOperator<br><br>功能：在指定的mysql数据库中执行sql代码</p>
</blockquote>
<h4 id="4-6-1-参数："><a href="#4-6-1-参数：" class="headerlink" title="4.6.1 参数："></a>4.6.1 参数：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql_conn_id (string)：数据库名</span><br><span class="line">sql：执行的sql语句</span><br><span class="line">database (string)：覆盖连接中定义的数据库名称</span><br></pre></td></tr></table></figure>
<h3 id="4-7-airflow-operators-presto-check-operator-PrestoValueCheckOperator-sql-pass-value-tolerance-None-presto-conn-id-’presto-default’-args-kwargs"><a href="#4-7-airflow-operators-presto-check-operator-PrestoValueCheckOperator-sql-pass-value-tolerance-None-presto-conn-id-’presto-default’-args-kwargs" class="headerlink" title="4.7 airflow.operators.presto_check_operator.PrestoValueCheckOperator(sql, pass_value, tolerance=None, presto_conn_id=’presto_default’, *args, **kwargs)"></a>4.7 airflow.operators.presto_check_operator.PrestoValueCheckOperator(sql, pass_value, tolerance=None, presto_conn_id=’presto_default’, *args, **kwargs)</h3><blockquote>
<p>基于：airflow.models.BaseOperator</p>
</blockquote>
<h4 id="4-7-1-参数："><a href="#4-7-1-参数：" class="headerlink" title="4.7.1 参数："></a>4.7.1 参数：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">python_callable (python callable)：可调用对象的引用</span><br><span class="line">op_kwargs (dict)：关键字参数字典，将在调用函数中解压</span><br><span class="line">op_args (list)：调用callable时将解压缩的位置参数列表</span><br><span class="line">provide_context (bool)：如果设置为true，Airflow将传递一组可在函数中使用的关键字参数。 这组kwargs完全对应于你在jinja模板中可以使用的内容，为此，您需要在函数头中定义** kwargs</span><br><span class="line">templates_dict (dict of str)：一个字典，其中的值是模板，这些模板将在__init__和执行之间的某个时间由Airflow引擎进行模板化，并在应用模板后在可调用的上下文中可用</span><br><span class="line">templates_exts (list(str))：处理模板化字段时要解析的文件扩展名列表</span><br></pre></td></tr></table></figure>
<h3 id="4-8-airflow-operators-python-operator-PythonVirtualenvOperator-python-callable-requirements-None-python-version-None-use-dill-False-system-site-packages-True-op-args-None-op-kwargs-None-string-args-None-templates-dict-None-templates-exts-None-args-kwargs"><a href="#4-8-airflow-operators-python-operator-PythonVirtualenvOperator-python-callable-requirements-None-python-version-None-use-dill-False-system-site-packages-True-op-args-None-op-kwargs-None-string-args-None-templates-dict-None-templates-exts-None-args-kwargs" class="headerlink" title="4.8 airflow.operators.python_operator.PythonVirtualenvOperator(python_callable, requirements=None, python_version=None, use_dill=False, system_site_packages=True, op_args=None, op_kwargs=None, string_args=None, templates_dict=None, templates_exts=None, *args, **kwargs)"></a>4.8 airflow.operators.python_operator.PythonVirtualenvOperator(python_callable, requirements=None, python_version=None, use_dill=False, system_site_packages=True, op_args=None, op_kwargs=None, string_args=None, templates_dict=None, templates_exts=None, *args, **kwargs)</h3><p>###4.9 airflow.operators.python_operator.ShortCircuitOperator(python_callable, op_args=None, op_kwargs=None, provide_context=False, templates_dict=None, templates_exts=None, *args, **kwargs)</p>
<blockquote>
<p>基于：airflow.operators.python_operator.PythonOperator, airflow.models.SkipMixin<br><br>功能：仅在满足条件时才允许工作流继续。 否则，将跳过工作流程“短路”和下游任务。<br>派生自PythonOperator，条件结果由python_callable决定</p>
</blockquote>
<h3 id="4-10-airflow-sensors-http-sensor-HttpSensor-endpoint-http-conn-id-’http-default’-method-’GET’-request-params-None-headers-None-response-check-None-extra-options-None-args-kwargs"><a href="#4-10-airflow-sensors-http-sensor-HttpSensor-endpoint-http-conn-id-’http-default’-method-’GET’-request-params-None-headers-None-response-check-None-extra-options-None-args-kwargs" class="headerlink" title="4.10 airflow.sensors.http_sensor.HttpSensor(endpoint, http_conn_id=’http_default’, method=’GET’, request_params=None, headers=None, response_check=None, extra_options=None, *args, **kwargs)"></a>4.10 airflow.sensors.http_sensor.HttpSensor(endpoint, http_conn_id=’http_default’, method=’GET’, request_params=None, headers=None, response_check=None, extra_options=None, *args, **kwargs)</h3><blockquote>
<p>基于：airflow.sensors.base_sensor_operator.BaseSensorOperator</p>
</blockquote>
<h4 id="4-10-1-参数："><a href="#4-10-1-参数：" class="headerlink" title="4.10.1 参数："></a>4.10.1 参数：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">http_conn_id (string)：连接</span><br><span class="line">method (string)：方法</span><br><span class="line">endpoint (string)：完整的url</span><br><span class="line">request_params (a dictionary of string key/value pairs)：添加到get的url参数</span><br><span class="line">headers (a dictionary of string key/value pairs)：添加到get请求的http头部</span><br><span class="line">response_check (A lambda or defined function.)：检查请求相应对象</span><br><span class="line">extra_options（选项字典，其中key是字符串，值取决于要修改的选项。）：“请求”库的额外选项，请参阅“请求”文档（修改超时，ssl等选项）</span><br></pre></td></tr></table></figure>
<h3 id="4-11-airflow-sensors-sql-sensor-SqlSensor-conn-id-sql-args-kwargs"><a href="#4-11-airflow-sensors-sql-sensor-SqlSensor-conn-id-sql-args-kwargs" class="headerlink" title="4.11 airflow.sensors.sql_sensor.SqlSensor(conn_id, sql, *args, **kwargs)"></a>4.11 airflow.sensors.sql_sensor.SqlSensor(conn_id, sql, *args, **kwargs)</h3><blockquote>
<p>基于：airflow.sensors.base_sensor_operator.BaseSensorOperator<br><br>功能：运行sql语句，直到满足条件。 它将继续尝试，而sql不返回任何行，或者如果第一个单元格返回（0，’0’，’’）</p>
</blockquote>
<h4 id="4-11-1-参数："><a href="#4-11-1-参数：" class="headerlink" title="4.11.1 参数："></a>4.11.1 参数：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">conn_id (string)</span><br><span class="line">sql</span><br></pre></td></tr></table></figure>
<h3 id="4-12-airflow-sensors-time-sensor-TimeSensor-target-time-args-kwargs"><a href="#4-12-airflow-sensors-time-sensor-TimeSensor-target-time-args-kwargs" class="headerlink" title="4.12 airflow.sensors.time_sensor.TimeSensor(target_time, *args, **kwargs)"></a>4.12 airflow.sensors.time_sensor.TimeSensor(target_time, *args, **kwargs)</h3><blockquote>
<p>基于：airflow.sensors.base_sensor_operator.BaseSensorOperator<br><br>功能：等到当天的指定时间</p>
</blockquote>
<h4 id="4-12-1-参数："><a href="#4-12-1-参数：" class="headerlink" title="4.12.1 参数："></a>4.12.1 参数：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">target_time (datetime.time)</span><br></pre></td></tr></table></figure>
<h3 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">4.13 airflow.sensors.time_delta_sensor.TimeDeltaSensor(delta, *args, **kwargs)</span><br><span class="line">4.14 airflow.sensors.web_hdfs_sensor.WebHdfsSensor(filepath, webhdfs_conn_id=&apos;webhdfs_default&apos;, *args, **kwargs)</span><br><span class="line">4.15 airflow.operators.latest_only_operator.LatestOnlyOperator(task_id, owner=&apos;Airflow&apos;, email=None, email_on_retry=True, email_on_failure=True, retries=0, retry_delay=datetime.timedelta(0, 300), retry_exponential_backoff=False, max_retry_delay=None, start_date=None, end_date=None, schedule_interval=None, depends_on_past=False, wait_for_downstream=False, dag=None, params=None, default_args=None, adhoc=False, priority_weight=1, weight_rule=&apos;downstream&apos;, queue=&apos;default&apos;, pool=None, sla=None, execution_timeout=None, on_failure_callback=None, on_success_callback=None, on_retry_callback=None, trigger_rule=&apos;all_success&apos;, resources=None, run_as_user=None, task_concurrency=None, executor_config=None, inlets=None, outlets=None, *args, **kwargs)</span><br><span class="line">4.16 airflow.operators.mssql_operator.MsSqlOperator(sql, mssql_conn_id=&apos;mssql_default&apos;, parameters=None, autocommit=False, database=None, *args, **kwargs)</span><br><span class="line">4.17 airflow.operators.mssql_to_hive.MsSqlToHiveTransfer(sql, hive_table, create=True, recreate=False, partition=None, delimiter=&apos;x01&apos;, mssql_conn_id=&apos;mssql_default&apos;, hive_cli_conn_id=&apos;hive_cli_default&apos;, tblproperties=None, *args, **kwargs)</span><br><span class="line">4.18 airflow.operators.dummy_operator.DummyOperator(*args, **kwargs)</span><br><span class="line">4.19 airflow.operators.mysql_to_hive.MySqlToHiveTransfer(sql, hive_table, create=True, recreate=False, partition=None, delimiter=&apos;x01&apos;, mysql_conn_id=&apos;mysql_default&apos;, hive_cli_conn_id=&apos;hive_cli_default&apos;, tblproperties=None, *args, **kwargs)</span><br><span class="line">4.20 airflow.operators.oracle_operator.OracleOperator(sql, oracle_conn_id=&apos;oracle_default&apos;, parameters=None, autocommit=False, *args, **kwargs)</span><br><span class="line">4.21 airflow.operators.pig_operator.PigOperator(pig, pig_cli_conn_id=&apos;pig_cli_default&apos;, pigparams_jinja_translate=False, *args, **kwargs)</span><br><span class="line">4.22 airflow.operators.postgres_operator.PostgresOperator(sql, postgres_conn_id=&apos;postgres_default&apos;, autocommit=False, parameters=None, database=None, *args, **kwargs)</span><br><span class="line">4.23 airflow.operators.presto_check_operator.PrestoCheckOperator(sql, presto_conn_id=&apos;presto_default&apos;, *args, **kwargs)</span><br><span class="line">4.24 airflow.operators.presto_check_operator.PrestoIntervalCheckOperator(table, metrics_thresholds, date_filter_column=&apos;ds&apos;, days_back=-7, presto_conn_id=&apos;presto_default&apos;, *args, **kwargs)</span><br><span class="line">4.25 airflow.operators.presto_to_mysql.PrestoToMySqlTransfer(sql, mysql_table, presto_conn_id=&apos;presto_default&apos;, mysql_conn_id=&apos;mysql_default&apos;, mysql_preoperator=None, *args, **kwargs)</span><br><span class="line">4.26 airflow.operators.druid_check_operator.DruidCheckOperator(sql, druid_broker_conn_id=&apos;druid_broker_default&apos;, *args, **kwargs)</span><br><span class="line">4.27 airflow.operators.generic_transfer.GenericTransfer(sql, destination_table, source_conn_id, destination_conn_id, preoperator=None, *args, **kwargs)</span><br><span class="line">4.28 airflow.operators.hive_to_druid.HiveToDruidTransfer(sql, druid_datasource, ts_dim, metric_spec=None, hive_cli_conn_id=&apos;hive_cli_default&apos;, druid_ingest_conn_id=&apos;druid_ingest_default&apos;, metastore_conn_id=&apos;metastore_default&apos;, hadoop_dependency_coordinates=None, intervals=None, num_shards=-1, target_partition_size=-1, query_granularity=&apos;NONE&apos;, segment_granularity=&apos;DAY&apos;, hive_tblproperties=None, *args, **kwargs)</span><br><span class="line">4.29 airflow.operators.s3_file_transform_operator.S3FileTransformOperator(source_s3_key, dest_s3_key, transform_script=None, select_expression=None, source_aws_conn_id=&apos;aws_default&apos;, dest_aws_conn_id=&apos;aws_default&apos;, replace=False, *args, **kwargs)</span><br><span class="line">4.30 airflow.operators.s3_to_hive_operator.S3ToHiveTransfer(s3_key, field_dict, hive_table, delimiter=&apos;, &apos;, create=True, recreate=False, partition=None, headers=False, check_headers=False, wildcard_match=False, aws_conn_id=&apos;aws_default&apos;, hive_cli_conn_id=&apos;hive_cli_default&apos;, input_compressed=False, tblproperties=None, select_expression=None, *args, **kwargs)</span><br><span class="line">4.31 airflow.operators.s3_to_redshift_operator.S3ToRedshiftTransfer(schema, table, s3_bucket, s3_key, redshift_conn_id=&apos;redshift_default&apos;, aws_conn_id=&apos;aws_default&apos;, copy_options=(), autocommit=False, parameters=None, *args, **kwargs)</span><br><span class="line">4.32 airflow.operators.hive_to_mysql.HiveToMySqlTransfer(sql, mysql_table, hiveserver2_conn_id=&apos;hiveserver2_default&apos;, mysql_conn_id=&apos;mysql_default&apos;, mysql_preoperator=None, mysql_postoperator=None, bulk_load=False, *args, **kwargs)</span><br><span class="line">4.33 airflow.operators.hive_to_samba_operator.Hive2SambaOperator(hql, destination_filepath, samba_conn_id=&apos;samba_default&apos;, hiveserver2_conn_id=&apos;hiveserver2_default&apos;, *args, **kwargs)</span><br><span class="line">4.34 airflow.sensors.metastore_partition_sensor.MetastorePartitionSensor(table, partition_name, schema=&apos;default&apos;, mysql_conn_id=&apos;metastore_mysql&apos;, *args, **kwargs)</span><br><span class="line">4.35 airflow.sensors.named_hive_partition_sensor.NamedHivePartitionSensor(partition_names, metastore_conn_id=&apos;metastore_default&apos;, poke_interval=180, hook=None, *args, **kwargs)</span><br><span class="line">4.36 airflow.sensors.s3_key_sensor.S3KeySensor(bucket_key, bucket_name=None, wildcard_match=False, aws_conn_id=&apos;aws_default&apos;, *args, **kwargs)</span><br><span class="line">4.37 airflow.sensors.s3_prefix_sensor.S3PrefixSensor(bucket_name, prefix, delimiter=&apos;/&apos;, aws_conn_id=&apos;aws_default&apos;, *args, **kwargs)</span><br><span class="line">4.38 airflow.operators.hive_operator.HiveOperator(hql, hive_cli_conn_id=&apos;hive_cli_default&apos;, schema=&apos;default&apos;, hiveconfs=None, hiveconf_jinja_translate=False, script_begin_tag=None, run_as_owner=False, mapred_queue=None, mapred_queue_priority=None, mapred_job_name=None, *args, **kwargs)</span><br><span class="line">4.39 airflow.operators.hive_stats_operator.HiveStatsCollectionOperator(table, partition, extra_exprs=None, col_blacklist=None, assignment_func=None, metastore_conn_id=&apos;metastore_default&apos;, presto_conn_id=&apos;presto_default&apos;, mysql_conn_id=&apos;airflow_db&apos;, *args, **kwargs)</span><br><span class="line">4.40 airflow.operators.check_operator.IntervalCheckOperator(table, metrics_thresholds, date_filter_column=&apos;ds&apos;, days_back=-7, conn_id=None, *args, **kwargs)</span><br><span class="line">4.41 airflow.operators.jdbc_operator.JdbcOperator(sql, jdbc_conn_id=&apos;jdbc_default&apos;, autocommit=False, parameters=None, *args, **kwargs)</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/12/03/airflow1/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="fengchuanling">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="枫川棂">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/12/03/airflow1/" itemprop="url">centos7 超完整安装airflow</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-12-03T17:10:42+08:00">
                2018-12-03
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/python-框架/" itemprop="url" rel="index">
                    <span itemprop="name">python-框架</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="1-airflow完整安装流程"><a href="#1-airflow完整安装流程" class="headerlink" title="1. airflow完整安装流程"></a>1. airflow完整安装流程</h1><h2 id="1-1-airflow-基础安装"><a href="#1-1-airflow-基础安装" class="headerlink" title="1.1 airflow 基础安装"></a>1.1 airflow 基础安装</h2><h5 id="1）默认自带python2环境，自行安装pip"><a href="#1）默认自带python2环境，自行安装pip" class="headerlink" title="1）默认自带python2环境，自行安装pip"></a>1）默认自带python2环境，自行安装pip</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum -y install epel-release</span><br><span class="line">yum install python-pip</span><br></pre></td></tr></table></figure>
<h5 id="2）进行pip的更新，否则很多安装会报错"><a href="#2）进行pip的更新，否则很多安装会报错" class="headerlink" title="2）进行pip的更新，否则很多安装会报错"></a>2）进行pip的更新，否则很多安装会报错</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pip install --upgrade pip</span><br><span class="line">pip install --upgrade setuptools</span><br></pre></td></tr></table></figure>
<h5 id="3）安装开发库"><a href="#3）安装开发库" class="headerlink" title="3）安装开发库"></a>3）安装开发库</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yum install python-devel</span><br><span class="line">yum install libevent-devel</span><br><span class="line">yum install mysql-devel</span><br></pre></td></tr></table></figure>
<h5 id="4）安装centos7下的mysql"><a href="#4）安装centos7下的mysql" class="headerlink" title="4）安装centos7下的mysql"></a>4）安装centos7下的mysql</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">yum -y install mariadb mariadb-server</span><br><span class="line">启动并设置开机启动</span><br><span class="line">systemctl start mariadb</span><br><span class="line">systemctl enable mariadb</span><br></pre></td></tr></table></figure>
<h5 id="5）初始化配置mysql"><a href="#5）初始化配置mysql" class="headerlink" title="5）初始化配置mysql"></a>5）初始化配置mysql</h5><blockquote>
<p>注：可以设定允许root远程登录，并且删除test和None用户，这样才能使得mysql允许远程登录<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql_secure_installation</span><br></pre></td></tr></table></figure></p>
</blockquote>
<h5 id="6）安装airflow"><a href="#6）安装airflow" class="headerlink" title="6）安装airflow"></a>6）安装airflow</h5><blockquote>
<p>在此之前需要设定临时环境变量<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">export SLUGIFY_USES_TEXT_UNIDECODE=yes</span><br><span class="line">pip install apache-airflow</span><br></pre></td></tr></table></figure></p>
</blockquote>
<h5 id="7）初始化airflow并启动"><a href="#7）初始化airflow并启动" class="headerlink" title="7）初始化airflow并启动"></a>7）初始化airflow并启动</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">airflow initdb</span><br><span class="line">airflow webserver -p 8080</span><br></pre></td></tr></table></figure>
<h5 id="8）防止密码明文存储"><a href="#8）防止密码明文存储" class="headerlink" title="8）防止密码明文存储"></a>8）防止密码明文存储</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install cryptography</span><br></pre></td></tr></table></figure>
<h2 id="1-2-airflow-mysql安装"><a href="#1-2-airflow-mysql安装" class="headerlink" title="1.2 airflow mysql安装"></a>1.2 airflow mysql安装</h2><h5 id="1）安装airflow-mysql"><a href="#1）安装airflow-mysql" class="headerlink" title="1）安装airflow-mysql"></a>1）安装airflow-mysql</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install apache-airflow[mysql]</span><br></pre></td></tr></table></figure>
<h5 id="2）创建airflow用户-创建airflow数据库并给出所有权限给次用户"><a href="#2）创建airflow用户-创建airflow数据库并给出所有权限给次用户" class="headerlink" title="2）创建airflow用户,创建airflow数据库并给出所有权限给次用户"></a>2）创建airflow用户,创建airflow数据库并给出所有权限给次用户</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">create database airflow;</span><br><span class="line">create user &apos;testairflow&apos;@&apos;%&apos; identified by &apos;123123&apos;;</span><br><span class="line">GRANT all privileges on airflow.* TO &apos;testairflow&apos;@&apos;%&apos;  IDENTIFIED BY &apos;123123&apos;;</span><br><span class="line">FLUSH PRIVILEGES;</span><br></pre></td></tr></table></figure>
<h5 id="3）修改airflow配置文件，指向数据库mysql"><a href="#3）修改airflow配置文件，指向数据库mysql" class="headerlink" title="3）修改airflow配置文件，指向数据库mysql"></a>3）修改airflow配置文件，指向数据库mysql</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~/airflow/airflow.cfg 文件修改：sql_alchemy_conn = mysql://ct:152108@localhost/airflow</span><br></pre></td></tr></table></figure>
<h5 id="4）进行mariadb更新，从5-5-60升级为10-2-19，然后修改配置文件添加参数-之后初始化数据库"><a href="#4）进行mariadb更新，从5-5-60升级为10-2-19，然后修改配置文件添加参数-之后初始化数据库" class="headerlink" title="4）进行mariadb更新，从5.5.60升级为10.2.19，然后修改配置文件添加参数,之后初始化数据库"></a>4）<a href="https://mrwayne66ll.github.io/2018/12/03/mariadb/" target="_blank" rel="noopener">进行mariadb更新，从5.5.60升级为10.2.19，</a>然后修改配置文件添加参数,之后初始化数据库</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/my.cnf</span><br><span class="line">explicit_defaults_for_timestamp=1   // 添加此行</span><br><span class="line">systemctl restart mariadb</span><br><span class="line">airflow initdb</span><br></pre></td></tr></table></figure>
<h2 id="1-3-airflow-安装配置celery-rabbitmq（官方推荐使用rabblitmq）"><a href="#1-3-airflow-安装配置celery-rabbitmq（官方推荐使用rabblitmq）" class="headerlink" title="1.3 airflow 安装配置celery+rabbitmq（官方推荐使用rabblitmq）"></a>1.3 airflow 安装配置celery+rabbitmq（官方推荐使用rabblitmq）</h2><h3 id="1-3-1-安装celery和rabbitmq组件"><a href="#1-3-1-安装celery和rabbitmq组件" class="headerlink" title="1.3.1 安装celery和rabbitmq组件"></a>1.3.1 安装celery和rabbitmq组件</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pip install airflow[celery] </span><br><span class="line">pip install airflow[rabbitmq]</span><br></pre></td></tr></table></figure>
<h3 id="1-3-2-系统安装rabbit"><a href="#1-3-2-系统安装rabbit" class="headerlink" title="1.3.2 系统安装rabbit"></a>1.3.2 系统安装rabbit</h3><h5 id="1）安装-erlang"><a href="#1）安装-erlang" class="headerlink" title="1）安装 erlang"></a>1）安装 erlang</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install erlang</span><br></pre></td></tr></table></figure>
<h5 id="2）安装-rabbitmq"><a href="#2）安装-rabbitmq" class="headerlink" title="2）安装 rabbitmq"></a>2）安装 rabbitmq</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wget http://www.rabbitmq.com/releases/rabbitmq-server/v3.6.15/rabbitmq-server-3.6.15-1.el6.noarch.rpm</span><br><span class="line">rpm --import https://www.rabbitmq.com/rabbitmq-release-signing-key.asc</span><br><span class="line">yum install rabbitmq-server-3.6.15-1.el6.noarch.rpm</span><br></pre></td></tr></table></figure>
<h5 id="3）配置rabbitmq（设置用户名root，密码123123，创建虚拟主机airflow-rabbitmq）"><a href="#3）配置rabbitmq（设置用户名root，密码123123，创建虚拟主机airflow-rabbitmq）" class="headerlink" title="3）配置rabbitmq（设置用户名root，密码123123，创建虚拟主机airflow-rabbitmq）"></a>3）配置rabbitmq（设置用户名root，密码123123，创建虚拟主机airflow-rabbitmq）</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">rabbitmqctl add_user root rabbitmq</span><br><span class="line">rabbitmqctl add_vhost airflow-rabbitmq</span><br><span class="line">rabbitmqctl set_user_tags root airflow-rabbitmq</span><br><span class="line">rabbitmqctl set_permissions -p airflow-rabbitmq root &quot;.*&quot; &quot;.*&quot; &quot;.*&quot;</span><br><span class="line">rabbitmq-plugins enable rabbitmq_management</span><br></pre></td></tr></table></figure>
<h3 id="1-3-3-修改airflow配置文件"><a href="#1-3-3-修改airflow配置文件" class="headerlink" title="1.3.3 修改airflow配置文件"></a>1.3.3 修改airflow配置文件</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">executor = CeleryExecutor</span><br><span class="line">broker_url = amqp://root:123123@localhost:5672/airflow-rabbitmq</span><br><span class="line">result_backend = amqp://root:123123@localhost:5672/airflow-rabbitmq</span><br></pre></td></tr></table></figure>
<h3 id="1-4-airflow-安装配置celery-redis"><a href="#1-4-airflow-安装配置celery-redis" class="headerlink" title="1.4 airflow 安装配置celery+redis"></a>1.4 airflow 安装配置celery+redis</h3><h3 id="1-3-1-安装redis"><a href="#1-3-1-安装redis" class="headerlink" title="1.3.1 安装redis"></a>1.3.1 安装redis</h3><h5 id="1）系统安装redis"><a href="#1）系统安装redis" class="headerlink" title="1）系统安装redis"></a>1）系统安装redis</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install redis</span><br></pre></td></tr></table></figure>
<h5 id="2）修改配置文件"><a href="#2）修改配置文件" class="headerlink" title="2）修改配置文件"></a>2）修改配置文件</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/redis.conf</span><br><span class="line">#bind 127.0.0.1 	// 注释掉，使redis允许远程访问</span><br><span class="line">requirepass 密码	// 修改这行，redis登录密码</span><br></pre></td></tr></table></figure>
<h5 id="3）开启redis服务"><a href="#3）开启redis服务" class="headerlink" title="3）开启redis服务"></a>3）开启redis服务</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl start redis</span><br></pre></td></tr></table></figure>
<h5 id="4）python下安装redis库"><a href="#4）python下安装redis库" class="headerlink" title="4）python下安装redis库"></a>4）python下安装redis库</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install redis</span><br></pre></td></tr></table></figure>
<h3 id="1-3-2-安装celery"><a href="#1-3-2-安装celery" class="headerlink" title="1.3.2 安装celery"></a>1.3.2 安装celery</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install celery</span><br></pre></td></tr></table></figure>
<h3 id="1-3-3-配置airflow-cfg"><a href="#1-3-3-配置airflow-cfg" class="headerlink" title="1.3.3 配置airflow.cfg"></a>1.3.3 配置airflow.cfg</h3><p>修改内容：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">executor = CeleryExecutor</span><br><span class="line">broker_url = redis://127.0.0.1:6379/0</span><br><span class="line">result_backend = redis://127.0.0.1:6379/0</span><br></pre></td></tr></table></figure></p>
<h3 id="1-3-4-airflow常用命令"><a href="#1-3-4-airflow常用命令" class="headerlink" title="1.3.4 airflow常用命令"></a>1.3.4 airflow常用命令</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">airflow webserver -p 8080	// 打开web服务</span><br><span class="line">airflow scheduler 		//打开调度器，必须启动，不然DAG在使用celeryExecutor和LocalExcutor没法run起来</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">airflow list_dags			//查看已有的dag列表</span><br><span class="line">airflow list_tasks tutorial	        //查看某个dag下的任务</span><br><span class="line">airflow list_tasks tutorial --tree 	//树形结构查看</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">airflow test dag_name task_name test_time</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">airflow run dagid [time] run task instance</span><br><span class="line">airflow backfill [dagid] -s[startTime] -e [endTime] run a backfill over 2 days</span><br></pre></td></tr></table></figure>
<h1 id="3-airflow-架构"><a href="#3-airflow-架构" class="headerlink" title="3. airflow 架构"></a>3. airflow 架构</h1><h2 id="3-1核心概念："><a href="#3-1核心概念：" class="headerlink" title="3.1核心概念："></a>3.1核心概念：</h2><blockquote>
<p>DAG有向无环图<br><br>一个DAG由多个task组成</p>
</blockquote>
<h2 id="3-2-包含组件："><a href="#3-2-包含组件：" class="headerlink" title="3.2 包含组件："></a>3.2 包含组件：</h2><h5 id="1）一个元数据库-mysql"><a href="#1）一个元数据库-mysql" class="headerlink" title="1）一个元数据库(mysql)"></a>1）一个元数据库(mysql)</h5><h5 id="2）一组airflow工作节点"><a href="#2）一组airflow工作节点" class="headerlink" title="2）一组airflow工作节点"></a>2）一组airflow工作节点</h5><h5 id="3）一个调节器-redis或RabbitMQ"><a href="#3）一个调节器-redis或RabbitMQ" class="headerlink" title="3）一个调节器(redis或RabbitMQ)"></a>3）一个调节器(redis或RabbitMQ)</h5><h5 id="4）一个airflow-web服务器"><a href="#4）一个airflow-web服务器" class="headerlink" title="4）一个airflow web服务器"></a>4）一个airflow web服务器</h5><h2 id="3-3-工作流依赖种类："><a href="#3-3-工作流依赖种类：" class="headerlink" title="3.3 工作流依赖种类："></a>3.3 工作流依赖种类：</h2><h5 id="1）时间依赖：定时触发任务"><a href="#1）时间依赖：定时触发任务" class="headerlink" title="1）时间依赖：定时触发任务"></a>1）时间依赖：定时触发任务</h5><p><code>完整支持crontab表达式，还支持python的datatime</code></p>
<h5 id="2）任务间依赖：任务A需要在任务B完成的基础上触发"><a href="#2）任务间依赖：任务A需要在任务B完成的基础上触发" class="headerlink" title="2）任务间依赖：任务A需要在任务B完成的基础上触发"></a>2）任务间依赖：任务A需要在任务B完成的基础上触发</h5><blockquote>
<h5 id="3）权限依赖：用户权限管理"><a href="#3）权限依赖：用户权限管理" class="headerlink" title="3）权限依赖：用户权限管理"></a>3）权限依赖：用户权限管理</h5><h5 id="4）机器依赖：任务的执行只能在某些指定机器上执行"><a href="#4）机器依赖：任务的执行只能在某些指定机器上执行" class="headerlink" title="4）机器依赖：任务的执行只能在某些指定机器上执行"></a>4）机器依赖：任务的执行只能在某些指定机器上执行</h5><p><code>在celeryExcuter可以使用不同的用户启动worker，不同的worker监听不同的queue，解决用户权限依赖问题；worker也可以启动在不同的机器上，解决机器依赖问题</code></p>
<h5 id="5）外部系统依赖：依赖各种外部数据库数据等，并且需要调用接口访问外部数据"><a href="#5）外部系统依赖：依赖各种外部数据库数据等，并且需要调用接口访问外部数据" class="headerlink" title="5）外部系统依赖：依赖各种外部数据库数据等，并且需要调用接口访问外部数据"></a>5）外部系统依赖：依赖各种外部数据库数据等，并且需要调用接口访问外部数据</h5><p><code>有一个hook机制，作用时建立一个与外部数据系统的连接，比如mysql、hdfs、本地文件系统，通过拓展的hook</code></p>
</blockquote>
<h5 id="6）资源依赖：某些任务消耗机器资源非常多，进行任务执行时需要对任务进行限制"><a href="#6）资源依赖：某些任务消耗机器资源非常多，进行任务执行时需要对任务进行限制" class="headerlink" title="6）资源依赖：某些任务消耗机器资源非常多，进行任务执行时需要对任务进行限制"></a>6）资源依赖：某些任务消耗机器资源非常多，进行任务执行时需要对任务进行限制</h5><blockquote>
<p><code>可以为任意的task指定一个抽象的pool，每个pool指定一个slot数，每启动一个task任务就占用一个slot数，当slot数占满之后就进入等待状态</code></p>
</blockquote>
<h1 id="3-4-基本使用过程"><a href="#3-4-基本使用过程" class="headerlink" title="3.4 基本使用过程"></a>3.4 基本使用过程</h1><h5 id="1）根据实际需要，使用不同的Operator"><a href="#1）根据实际需要，使用不同的Operator" class="headerlink" title="1）根据实际需要，使用不同的Operator"></a>1）根据实际需要，使用不同的Operator</h5><h5 id="2）传入具体的参数，定义一系列的tasks-operator是task的抽象类"><a href="#2）传入具体的参数，定义一系列的tasks-operator是task的抽象类" class="headerlink" title="2）传入具体的参数，定义一系列的tasks    // operator是task的抽象类"></a>2）传入具体的参数，定义一系列的tasks    // operator是task的抽象类</h5><h5 id="3）定义tasks之间的关系，形成一个DAG"><a href="#3）定义tasks之间的关系，形成一个DAG" class="headerlink" title="3）定义tasks之间的关系，形成一个DAG"></a>3）定义tasks之间的关系，形成一个DAG</h5><h5 id="4）调度DAG运行，每个task会形成一个instance"><a href="#4）调度DAG运行，每个task会形成一个instance" class="headerlink" title="4）调度DAG运行，每个task会形成一个instance"></a>4）调度DAG运行，每个task会形成一个instance</h5><h5 id="5）使用命令或者web-ui进行查看管理"><a href="#5）使用命令或者web-ui进行查看管理" class="headerlink" title="5）使用命令或者web ui进行查看管理"></a>5）使用命令或者web ui进行查看管理</h5>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  


          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">fengchuanling</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">9</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">4</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">9</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">fengchuanling</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  



  
  









  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  

  
  
    <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>
  

  
  
    <script type="text/javascript" src="/lib/three/three.min.js"></script>
  

  
  
    <script type="text/javascript" src="/lib/three/three-waves.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
