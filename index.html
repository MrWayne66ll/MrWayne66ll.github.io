<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT">










<meta property="og:type" content="website">
<meta property="og:title" content="枫川棂">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="枫川棂">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="枫川棂">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/">





  <title>枫川棂</title>
  








</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="default">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">枫川棂</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">Come From FCL.PDD</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            Archives
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/12/09/celery/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="fengchuanling">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="枫川棂">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/12/09/celery/" itemprop="url">celery 安装及使用</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-12-09T18:25:50+08:00">
                2018-12-09
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/python-框架/" itemprop="url" rel="index">
                    <span itemprop="name">python-框架</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="1-centos7-下安装celery"><a href="#1-centos7-下安装celery" class="headerlink" title="1. centos7 下安装celery"></a>1. centos7 下安装celery</h1><h3 id="1-1-安装pip"><a href="#1-1-安装pip" class="headerlink" title="1.1 安装pip"></a>1.1 安装pip</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum -y install epel-release</span><br><span class="line">yum install python-pip</span><br></pre></td></tr></table></figure>
<h3 id="1-2-更新pip"><a href="#1-2-更新pip" class="headerlink" title="1.2 更新pip"></a>1.2 更新pip</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pip install --upgrade pip</span><br><span class="line">pip install --upgrade setuptools</span><br></pre></td></tr></table></figure>
<h3 id="1-3-安装celery"><a href="#1-3-安装celery" class="headerlink" title="1.3 安装celery"></a>1.3 安装celery</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install -U Celery</span><br></pre></td></tr></table></figure>
<h3 id="1-4-中间人安装，选择使用redis"><a href="#1-4-中间人安装，选择使用redis" class="headerlink" title="1.4 中间人安装，选择使用redis"></a>1.4 中间人安装，选择使用redis</h3><h4 id="1-4-1-安装redis"><a href="#1-4-1-安装redis" class="headerlink" title="1.4.1 安装redis"></a>1.4.1 安装redis</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">yum -y install redis</span><br><span class="line">vim /etc/redis.conf</span><br><span class="line">#bind 127.0.0.1     // 注释掉，使redis允许远程访问</span><br><span class="line">requirepass 密码  // 修改这行，redis登录密码</span><br></pre></td></tr></table></figure>
<h4 id="1-4-2-安装额外依赖"><a href="#1-4-2-安装额外依赖" class="headerlink" title="1.4.2 安装额外依赖"></a>1.4.2 安装额外依赖</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install -U celery[redis]</span><br></pre></td></tr></table></figure>
<h4 id="1-4-3-redis在celery下的使用配置"><a href="#1-4-3-redis在celery下的使用配置" class="headerlink" title="1.4.3 redis在celery下的使用配置"></a>1.4.3 redis在celery下的使用配置</h4><blockquote>
<p>1）使用配置，只需要设置redis的位置：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">例如：BROKER_URL = &apos;redis://localhost:6379/0&apos;</span><br><span class="line">格式解释：redis://:password@hostname:port/db_number</span><br></pre></td></tr></table></figure></p>
</blockquote>
<blockquote>
<p>2）可见性超时<br><br>可见性超时定义了等待职程在消息分派到其他程序之前确认收到任务的秒数<br>通过以下方式配置：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">BROKER_TRANSPORT_OPTIONS = &#123;&apos;visibility_timeout&apos;: 3600&#125;  // 默认为1小时</span><br></pre></td></tr></table></figure></p>
</blockquote>
<blockquote>
<p>这个时间会导致一种情况：任务循环重新执行；可以通过延长可见性时间来解决这个状况，例如<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">BROKER_TRANSPORT_OPTIONS = &#123;&apos;visibility_timeout&apos;: 43200&#125;</span><br></pre></td></tr></table></figure></p>
</blockquote>
<blockquote>
<p>3）存储任务的状态和返回值<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CELERY_RESULT_BACKEND = &apos;redis://localhost:6379/0&apos; 			//配置这个参数</span><br></pre></td></tr></table></figure></p>
</blockquote>
<blockquote>
<p>4）广播信息默认对所有虚拟主机可见，配置成只能被活跃的虚机接受<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">BROKER_TRANSPORT_OPTIONS = &#123;&apos;fanout_prefix&apos;: True&#125;</span><br></pre></td></tr></table></figure></p>
</blockquote>
<h1 id="2-celery-架构理解"><a href="#2-celery-架构理解" class="headerlink" title="2. celery 架构理解"></a>2. celery 架构理解</h1><p><img src="https://img2018.cnblogs.com/blog/1075630/201812/1075630-20181209154829362-1819648776.png" alt=""></p>
<h3 id="2-1-模块各功能"><a href="#2-1-模块各功能" class="headerlink" title="2.1 模块各功能"></a>2.1 模块各功能</h3><blockquote>
<p>1）任务生产者(task producer)<br><br>负责生产计算任务，交给消息队列进行处理。只要是调用了celery的api，我们都可以称为是任务生产者。<br><br>2）任务调度器(celery beat)<br><br>任务调度器是以独立的进程形式存在，它会读取配置文件的内容，周期性的将任务的请求发给任务队列。celery beat是celery自带的任务生产者，系统管理员可以选择关闭或者开启它，同事一个celery系统只能有一个celery beat调度器。<br><br>3）任务代理(broker)<br><br>任务代理方负责接收任务生产者发送过来的任务处理消息，存进队列之后再进行调度，分发给任务消费方。因为任务处理是基于message的，所以一般选择使用rabbitmq或者redis等消息队列或者数据库作为celery的message boker<br><br>4）任务消费方(celery worker)<br><br>celery worker就是执行任务的一方，它负责接收任务处理中间方发来的任务处理请求，完成这些任务，并且返回任务处理的结果。可多节点部署celery worker。<br><br>5）结果保存<br><br>celery支持任务处理完之后将状态信息和结果的保存，以供查询。<br></p>
</blockquote>
<h3 id="2-2-功能尝试"><a href="#2-2-功能尝试" class="headerlink" title="2.2 功能尝试"></a>2.2 功能尝试</h3><h4 id="2-1-1-任务生产者入口"><a href="#2-1-1-任务生产者入口" class="headerlink" title="2.1.1 任务生产者入口"></a>2.1.1 任务生产者入口</h4><p>1）创建celery对象<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">from celery import Celery</span><br><span class="line">import time</span><br><span class="line"></span><br><span class="line">app = Celery(&apos;notify_friends&apos;, backend=&apos;redis://:123123@localhost:6379/0&apos;,broker = &apos;redis://:123123@localhost:6379/0&apos;)</span><br><span class="line"></span><br><span class="line">@app.task</span><br><span class="line">def notify_friends(userId,newsId):</span><br><span class="line">        print &apos;Start at task at &#123;0&#125;, userId: &#123;1&#125;, newsId: &#123;2&#125; .&apos;.format(time.ctime(),userId,newsId)</span><br><span class="line">        time.sleep(2)</span><br><span class="line">        print &apos;Task notify_friends success at &#123;0&#125;&apos;.format(time.ctime())</span><br><span class="line">        return True</span><br></pre></td></tr></table></figure></p>
<p>2）启动celery worker<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">celery -A notify_friends worker --loglevel=info</span><br></pre></td></tr></table></figure></p>
<p>3）调用celery api<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">from notify_friends import notify_friends</span><br><span class="line">import time</span><br><span class="line"></span><br><span class="line">def notify(userId,newsId):</span><br><span class="line">        result = notify_friends.delay(userId,newsId)</span><br><span class="line">        while not result.ready():</span><br><span class="line">                time.sleep(1)</span><br><span class="line">                print result.get(timeout=10)</span><br><span class="line">if __name__ == &apos;__main__&apos;:</span><br><span class="line">        for i in range(10):</span><br><span class="line">                notify(&apos;root&apos;,str(i))</span><br></pre></td></tr></table></figure></p>
<p>2.1.2 任务调度器入口（定时任务调用celery api）<br>1）创建配置文件，定义schedule<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">from datetime import timedelta</span><br><span class="line"></span><br><span class="line">CELERYBEAT_SCHEDULE = &#123;</span><br><span class="line">        &apos;select_popular_book&apos;:&#123;</span><br><span class="line">                &apos;task&apos;: &apos;favourite_book.select_popular_book&apos;,</span><br><span class="line">                &apos;schedule&apos;: timedelta(seconds=10),</span><br><span class="line">        &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>2）创建celery对象，并且加载配置文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">from celery import Celery</span><br><span class="line">import time</span><br><span class="line"></span><br><span class="line">app = Celery(&apos;select_popular_book&apos;,backend=&apos;redis://:123123@localhost:6379/0&apos;,broker = &apos;redis://:123123@localhost:6379/0&apos;,)</span><br><span class="line">app.config_from_object(&apos;config&apos;)</span><br><span class="line"></span><br><span class="line">@app.task</span><br><span class="line">def select_popular_book():</span><br><span class="line">        print &apos;Start at &#123;0&#125;&apos;.format(time.ctime())</span><br><span class="line">        time.sleep(2)</span><br><span class="line">        print &apos;Task ... success at &#123;0&#125;&apos;.format(time.ctime())</span><br><span class="line">        return True</span><br></pre></td></tr></table></figure></p>
<p>3）启动celery worker<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">celery -A notify_friends worker --loglevel=info</span><br></pre></td></tr></table></figure></p>
<p>4）启动celery beat<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">celery -A favorite_book beat</span><br></pre></td></tr></table></figure></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/12/07/airflow3/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="fengchuanling">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="枫川棂">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/12/07/airflow3/" itemprop="url">airflow-api 插件的安装与使用介绍</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-12-07T17:54:29+08:00">
                2018-12-07
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/python-框架/" itemprop="url" rel="index">
                    <span itemprop="name">python-框架</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="1-安装插件airflow-rest-api"><a href="#1-安装插件airflow-rest-api" class="headerlink" title="1. 安装插件airflow-rest-api"></a>1. 安装插件<a href="https://github.com/teamclairvoyant/airflow-rest-api-plugin" target="_blank" rel="noopener">airflow-rest-api</a></h1><blockquote>
<p>1）获取<br><br><code>wget https://github.com/teamclairvoyant/airflow-rest-api-plugin/archive/master.zip</code><br><br>2）将plugin文件夹下的内容放入airflow/plugin/下，若不存在则新建<br><br>3）重启airflow</p>
</blockquote>
<h1 id="2-api使用介绍"><a href="#2-api使用介绍" class="headerlink" title="2. api使用介绍"></a>2. api使用介绍</h1><h3 id="2-1-获取airflow版本"><a href="#2-1-获取airflow版本" class="headerlink" title="2.1 获取airflow版本"></a>2.1 获取airflow版本</h3><blockquote>
<p>GET - http://{HOST}:{PORT}/admin/rest_api/api?api=version</p>
</blockquote>
<h3 id="2-2-获取airflow-api-plugin的版本"><a href="#2-2-获取airflow-api-plugin的版本" class="headerlink" title="2.2 获取airflow-api-plugin的版本"></a>2.2 获取airflow-api-plugin的版本</h3><blockquote>
<p>GET - http://{HOST}:{PORT}/admin/rest_api/api?api=rest_api_plugin_version</p>
</blockquote>
<h3 id="2-3-渲染任务实例模板"><a href="#2-3-渲染任务实例模板" class="headerlink" title="2.3 渲染任务实例模板"></a>2.3 渲染任务实例模板</h3><blockquote>
<p>GET - http://{HOST}:{PORT}/admin/rest_api/api?api=render<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">参数：</span><br><span class="line">1）dag_id</span><br><span class="line">2）task_id	任务id</span><br><span class="line">3）execution_date	dag的执行日期，例如：2017-01-02T03：04：05</span><br><span class="line">4）subdir(可选)	从中查找文件位置或目录</span><br></pre></td></tr></table></figure></p>
</blockquote>
<h3 id="2-4-操作变量"><a href="#2-4-操作变量" class="headerlink" title="2.4 操作变量"></a>2.4 操作变量</h3><blockquote>
<p>GET - http://{HOST}:{PORT}/admin/rest_api/api?api=variables<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">参数(均为可选参数)：</span><br><span class="line">1）set：设置变量，key value</span><br><span class="line">2）get：获取变量</span><br><span class="line">3）json：布尔值，反序列化json</span><br><span class="line">4）default：如果变量不存在，则返回默认值</span><br><span class="line">5）import：从json文件导入变量</span><br><span class="line">6）export：从json文件导出变量</span><br><span class="line">7）delete：删除变量</span><br></pre></td></tr></table></figure></p>
</blockquote>
<h3 id="2-5-操作连接"><a href="#2-5-操作连接" class="headerlink" title="2.5 操作连接"></a>2.5 操作连接</h3><blockquote>
<p>GET - http://{HOST}:{PORT}/admin/rest_api/api?api=connections<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">参数(均为可选参数)：</span><br><span class="line">1）list：布尔型，列出所有连接</span><br><span class="line">2）add：增加连接</span><br><span class="line">3）delete：布尔型，删除连接</span><br><span class="line">4）conn_id：添加/删除连接所需要的连接id</span><br><span class="line">5）conn_id：添加连接所需要的连接url</span><br><span class="line">6）conn_extra：连接的额外字段，添加连接时可选参数</span><br></pre></td></tr></table></figure></p>
</blockquote>
<h3 id="2-6-暂停DAG"><a href="#2-6-暂停DAG" class="headerlink" title="2.6 暂停DAG"></a>2.6 暂停DAG</h3><blockquote>
<p>GET - http://{HOST}:{PORT}/admin/rest_api/api?api=pause<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">参数：</span><br><span class="line">1）dag_id</span><br><span class="line">2）subdir：可选参数，从中查找dag的文件位置或者目录</span><br></pre></td></tr></table></figure></p>
</blockquote>
<h3 id="2-7-继续dag"><a href="#2-7-继续dag" class="headerlink" title="2.7 继续dag"></a>2.7 继续dag</h3><blockquote>
<p>GET - http://{HOST}:{PORT}/admin/rest_api/api?api=unpause<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">参数：</span><br><span class="line">1）dag_id</span><br><span class="line">2）subdir：可选参数，从中查找dag的文件位置或者目录</span><br></pre></td></tr></table></figure></p>
</blockquote>
<h3 id="2-8-调度任务失败的依赖"><a href="#2-8-调度任务失败的依赖" class="headerlink" title="2.8 调度任务失败的依赖"></a>2.8 调度任务失败的依赖</h3><blockquote>
<p>GET - http://{HOST}:{PORT}/admin/rest_api/api?api=task_failed_deps<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">参数：</span><br><span class="line">1）dag_id</span><br><span class="line">2）task_id</span><br><span class="line">3）execution_date</span><br><span class="line">4）subdir：可选</span><br></pre></td></tr></table></figure></p>
</blockquote>
<h3 id="2-9-触发dag运行"><a href="#2-9-触发dag运行" class="headerlink" title="2.9 触发dag运行"></a>2.9 触发dag运行</h3><blockquote>
<p>GET - http://{HOST}:{PORT}/admin/rest_api/api?api=trigger_dag<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">参数：</span><br><span class="line">1）dag_id</span><br><span class="line">2）run_id：可选参数，用于dag运行的runid</span><br><span class="line">3）conf：可选参数，传递给触发dag运行的一些配置，（URL Encoded JSON）以&#123;&quot;key&quot;:&quot;value&quot;&#125;的形式</span><br></pre></td></tr></table></figure></p>
</blockquote>
<h3 id="2-10-测试任务实例，但是不检查依赖或者在数据库中记录"><a href="#2-10-测试任务实例，但是不检查依赖或者在数据库中记录" class="headerlink" title="2.10 测试任务实例，但是不检查依赖或者在数据库中记录"></a>2.10 测试任务实例，但是不检查依赖或者在数据库中记录</h3><blockquote>
<p>GET - http://{HOST}:{PORT}/admin/rest_api/api?api=test<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">参数：</span><br><span class="line">1）dag_id</span><br><span class="line">2）task_id</span><br><span class="line">3）execution_date</span><br><span class="line">4）subdir：可选参数</span><br><span class="line">5）dryrun：可选参数，布尔型，是否进行干运行</span><br><span class="line">6）task_params：可选参数，将json字典传给task</span><br></pre></td></tr></table></figure></p>
</blockquote>
<h3 id="2-11-获取dag运行状态"><a href="#2-11-获取dag运行状态" class="headerlink" title="2.11 获取dag运行状态"></a>2.11 获取dag运行状态</h3><blockquote>
<p>GET - http://{HOST}:{PORT}/admin/rest_api/api?api=dag_state<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">参数：</span><br><span class="line">1）dag_id</span><br><span class="line">2）execution_date</span><br><span class="line">3）subdir：可选参数</span><br></pre></td></tr></table></figure></p>
</blockquote>
<h3 id="2-12-运行单个task实例"><a href="#2-12-运行单个task实例" class="headerlink" title="2.12 运行单个task实例"></a>2.12 运行单个task实例</h3><blockquote>
<p>GET - http://{HOST}:{PORT}/admin/rest_api/api?api=run<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">参数：</span><br><span class="line">1）dag_id</span><br><span class="line">2）task_id</span><br><span class="line">3）execution_date</span><br><span class="line">4）subdir：可选参数</span><br><span class="line">5）mark_success：可选参数，布尔型，不运行jobs但是标记为成功</span><br><span class="line">6）force：可选参数，布尔型，忽略先前的运行状态，无论任务是否成功都重新运行</span><br><span class="line">7）pool：可选参数，资源池</span><br><span class="line">8）cfg_path：可选参数，使用配置文件的路径而不用原有的airflow.cfg</span><br><span class="line">9）local：可选参数，布尔值，使用localexecute运行任务</span><br><span class="line">10）ignore_all_dependencies：可选参数，布尔值，忽略所有的非关键依赖项，包括ignore_ti_state和ignore_task_depsstore_true</span><br><span class="line">11）ignore_dependencies：可选，布尔值，忽略特定于任务的依赖关系，例如upstream, depends_on_past还有retry delay dependencies</span><br><span class="line">12）ignore_depends_on_past：可选，布尔值，忽略depends_on_past依赖项，但是尊重上游</span><br><span class="line">13）ship_dag：可选，布尔值，序列化dag并发送给worker</span><br><span class="line">14）pickle：可选：整个dag的序列化pickle对象</span><br></pre></td></tr></table></figure></p>
</blockquote>
<h3 id="2-13-某个dag的所有tasks"><a href="#2-13-某个dag的所有tasks" class="headerlink" title="2.13 某个dag的所有tasks"></a>2.13 某个dag的所有tasks</h3><blockquote>
<p>GET - http://{HOST}:{PORT}/admin/rest_api/api?api=list_tasks<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">参数：</span><br><span class="line">1）dag_id</span><br><span class="line">2）tree：可选参数，布尔型</span><br><span class="line">3）subdir：可选参数</span><br></pre></td></tr></table></figure></p>
</blockquote>
<h3 id="2-14-在制定范围内运行dag的子部分"><a href="#2-14-在制定范围内运行dag的子部分" class="headerlink" title="2.14 在制定范围内运行dag的子部分"></a>2.14 在制定范围内运行dag的子部分</h3><blockquote>
<p>GET - http://{HOST}:{PORT}/admin/rest_api/api?api=backfill<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">参数：</span><br><span class="line">1）dag_id</span><br><span class="line">2）task_regex：可选参数，用于过滤特定的task_ids以进行回填正则表达式</span><br><span class="line">3）start_date：覆盖start_date YYYY-MM-DD</span><br><span class="line">4）end_date：可选参数，同上覆盖</span><br><span class="line">5）mark_success：可选参数，布尔型，不运行jobs但是标记为成功</span><br><span class="line">6）local：可选参数，布尔型，使用LocalExecutor运行任务</span><br><span class="line">7）donot_pickle：可选参数，不进行尝试将dag对象发给工作人员，只告诉他们dag的运行版本</span><br><span class="line">8）include_adhoc：可选参数，布尔值，包含带有adhoc参数的dags</span><br><span class="line">9）ignore_dependencies：可选参数，布尔值，忽略特定于任务的依赖关系，例如 upstream, depends_on_past, and retry delay dependencies</span><br><span class="line">10）ignore_first_depends_on_past：可选参数，布尔值，仅忽略第一组任务的depends_on_past依赖关系</span><br><span class="line">11）subdir：可选参数，</span><br><span class="line">12）pool：可选参数，资源池</span><br><span class="line">13）dry_run：可选参数，布尔值，是否空运行</span><br></pre></td></tr></table></figure></p>
</blockquote>
<h3 id="2-15-列出所有的dags"><a href="#2-15-列出所有的dags" class="headerlink" title="2.15 列出所有的dags"></a>2.15 列出所有的dags</h3><blockquote>
<p>GET - http://{HOST}:{PORT}/admin/rest_api/api?api=list_dags<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">参数：	</span><br><span class="line">1）subdir：可选参数</span><br><span class="line">2）report：可选参数，布尔型，显示dagbag的加载报告</span><br></pre></td></tr></table></figure></p>
</blockquote>
<h3 id="2-16-启动kerberos票证续订"><a href="#2-16-启动kerberos票证续订" class="headerlink" title="2.16 启动kerberos票证续订"></a>2.16 启动kerberos票证续订</h3><blockquote>
<p>GET - http://{HOST}:{PORT}/admin/rest_api/api?api=kerberos<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">参数（均为可选参数）：</span><br><span class="line">1）principal</span><br><span class="line">2）keytab</span><br><span class="line">3）pid：pid文件位置</span><br><span class="line">4）daemon：布尔值，是否为守护进程</span><br><span class="line">5）stdout：将stdout重定向到文件</span><br><span class="line">6）stderr：将错误重定向到文件</span><br><span class="line">7）log-file：日志文件</span><br></pre></td></tr></table></figure></p>
</blockquote>
<h3 id="2-17-启动celery工作节点（worker）"><a href="#2-17-启动celery工作节点（worker）" class="headerlink" title="2.17 启动celery工作节点（worker）"></a>2.17 启动celery工作节点（worker）</h3><blockquote>
<p>GET - http://{HOST}:{PORT}/admin/rest_api/api?api=worker<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">参数（均为可选参数）：</span><br><span class="line">1）do_pickle：布尔型，尝试picklg DAG对象发送给worker，而不是让worker运行他们的代码版本</span><br><span class="line">2）queues：逗号分隔的队列列表</span><br><span class="line">3）concurrency：工作进程数</span><br><span class="line">4）pid：pid文件位置</span><br><span class="line">5）daemon：布尔值，是否为守护进程</span><br><span class="line">6）stdout：将stdout重定向到文件</span><br><span class="line">7）stderr：将错误重定向到文件</span><br><span class="line">8）log-file：日志文件</span><br></pre></td></tr></table></figure></p>
</blockquote>
<h3 id="2-18-启动celery工作节点（flower）"><a href="#2-18-启动celery工作节点（flower）" class="headerlink" title="2.18 启动celery工作节点（flower）"></a>2.18 启动celery工作节点（flower）</h3><blockquote>
<p>GET - http://{HOST}:{PORT}/admin/rest_api/api?api=flower<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">参数（均为可选参数）：</span><br><span class="line">1）hostname：设置运行服务器的主机名</span><br><span class="line">2）port：运行服务器的端口</span><br><span class="line">3）flower_conf：flower的配置文件</span><br><span class="line">4）broker_api</span><br><span class="line">5）pid：pid文件位置</span><br><span class="line">6）daemon：布尔值，是否为守护进程</span><br><span class="line">7）stdout：将stdout重定向到文件</span><br><span class="line">8）stderr：将错误重定向到文件</span><br><span class="line">9）log-file：日志文件</span><br></pre></td></tr></table></figure></p>
</blockquote>
<h3 id="2-19-启动调度程序实例"><a href="#2-19-启动调度程序实例" class="headerlink" title="2.19 启动调度程序实例"></a>2.19 启动调度程序实例</h3><blockquote>
<p>GET - http://{HOST}:{PORT}/admin/rest_api/api?api=scheduler<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">参数（均为可选参数）：</span><br><span class="line">1）dag_id</span><br><span class="line">2）subdir：可选参数，从中查找dag的文件位置或者目录</span><br><span class="line">3）run-duration：设置退出前执行的秒数</span><br><span class="line">4）num_runs：设置退出前执行的次数</span><br><span class="line">5）do_pickle：布尔型，尝试pickle DAG对象发送给worker，而不是让worker运行他们的代码版本</span><br><span class="line">6）pid：pid文件位置</span><br><span class="line">7）daemon：布尔值，是否为守护进程</span><br><span class="line">8）stdout：将stdout重定向到文件</span><br><span class="line">9）stderr：将错误重定向到文件</span><br><span class="line">10）log-file：日志文件</span><br></pre></td></tr></table></figure></p>
</blockquote>
<h3 id="2-20-获取task的运行状态"><a href="#2-20-获取task的运行状态" class="headerlink" title="2.20 获取task的运行状态"></a>2.20 获取task的运行状态</h3><blockquote>
<p>GET - http://{HOST}:{PORT}/admin/rest_api/api?api=task_state<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">参数：</span><br><span class="line">1）dag_id</span><br><span class="line">2）task_id</span><br><span class="line">3）execution_date</span><br><span class="line">4）subdir：可选</span><br></pre></td></tr></table></figure></p>
</blockquote>
<h3 id="2-21-CRUD-对pool的操作"><a href="#2-21-CRUD-对pool的操作" class="headerlink" title="2.21 CRUD 对pool的操作"></a>2.21 CRUD 对pool的操作</h3><blockquote>
<p>GET - http://{HOST}:{PORT}/admin/rest_api/api?api=pool<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">参数：</span><br><span class="line">1）set：分别设置池插槽计数和描述。 表单中的预期输入：NAME SLOT_COUNT POOL_DESCRIPTION</span><br><span class="line">2）get：获取池信息</span><br><span class="line">3）delete：删除池</span><br></pre></td></tr></table></figure></p>
</blockquote>
<h3 id="2-22-由worker生成的日志"><a href="#2-22-由worker生成的日志" class="headerlink" title="2.22 由worker生成的日志"></a>2.22 由worker生成的日志</h3><blockquote>
<p>GET - http://{HOST}:{PORT}/admin/rest_api/api?api=serve_logs<br><br>参数：无</p>
</blockquote>
<h3 id="2-23-清除一组任务实例"><a href="#2-23-清除一组任务实例" class="headerlink" title="2.23 清除一组任务实例"></a>2.23 清除一组任务实例</h3><blockquote>
<p>GET - http://{HOST}:{PORT}/admin/rest_api/api?api=clear<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">参数：</span><br><span class="line">1）dag_id</span><br><span class="line">2）task_regex：可选参数，用于过滤特定的task_ids以进行回填正则表达式</span><br><span class="line">3）start_date：覆盖start_date YYYY-MM-DD</span><br><span class="line">4）end_date：可选参数，同上覆盖</span><br><span class="line">5）subdir：可选参数</span><br><span class="line">6）upstream：可选，布尔型，包含上游任务</span><br><span class="line">7）downstream：可选，布尔型，包含下游任务</span><br><span class="line">8）no_confirm：可选，布尔型，不要求确认</span><br><span class="line">9）only_failed：可选，布尔型，仅失败的作业</span><br><span class="line">10）only_running：可选，布尔型，仅运行的作业</span><br><span class="line">11）exclude_subdags：可选，布尔型，排除子标记</span><br></pre></td></tr></table></figure></p>
</blockquote>
<h3 id="2-24-发布一个新的dag"><a href="#2-24-发布一个新的dag" class="headerlink" title="2.24 发布一个新的dag"></a>2.24 发布一个新的dag</h3><blockquote>
<p>POST - http://{HOST}:{PORT}/admin/rest_api/api?api=deploy_dag<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">post参数：</span><br><span class="line">1）dag_file：file-上传部署的py文件</span><br><span class="line">2）force：可选，布尔型，文件已存在，是否强制上传</span><br><span class="line">3）pause：可选，布尔型，在创建时强制暂停dag并覆盖&apos;dags_are_paused_at_creation&apos;配置</span><br><span class="line">4）unpause（可选） - 布尔值 -  DAG在创建时将被强制取消暂停，并覆盖&apos;dags_are_paused_at_creation&apos;配置</span><br></pre></td></tr></table></figure></p>
</blockquote>
<h3 id="2-25-刷新一个dag"><a href="#2-25-刷新一个dag" class="headerlink" title="2.25 刷新一个dag"></a>2.25 刷新一个dag</h3><blockquote>
<p>GET - http://{HOST}:{PORT}/admin/rest_api/api?api=refresh_dag<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">参数：	</span><br><span class="line">1）dag_id</span><br></pre></td></tr></table></figure></p>
</blockquote>
<h1 id="3-api响应参数："><a href="#3-api响应参数：" class="headerlink" title="3. api响应参数："></a>3. api响应参数：</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">airflow_cmd  - 字符串 - 在本地计算机上运行Airflow CLI命令</span><br><span class="line">arguments  -  Dict  - 包含您传入的参数的字典及其值</span><br><span class="line">post_arguments  -  Dict  - 包含您传入的帖子身体参数及其值的字典</span><br><span class="line">call_time  - 时间戳 - 服务器接收请求的时间</span><br><span class="line">output  -  String  - 调用CLI函数的文本输出</span><br><span class="line">response_time  - 时间戳 - 服务器发回响应的时间</span><br><span class="line">status  - 字符串 - 响应呼叫的状态。 （可能的值：OK，ERROR）</span><br><span class="line">warning  -  String  - 从API发回的警告消息</span><br><span class="line">http_response_code  - 整数 -  HTTP响应代码</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/12/03/airflow2/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="fengchuanling">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="枫川棂">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/12/03/airflow2/" itemprop="url">airflow 文档学习(一) 基本Operator</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-12-03T17:47:06+08:00">
                2018-12-03
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/python-框架/" itemprop="url" rel="index">
                    <span itemprop="name">python-框架</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="1-Operator和task"><a href="#1-Operator和task" class="headerlink" title="1. Operator和task"></a>1. Operator和task</h1><blockquote>
<p>简单来说，Operator就是task的抽象类</p>
</blockquote>
<h1 id="2-BaseOperator"><a href="#2-BaseOperator" class="headerlink" title="2. BaseOperator"></a>2. BaseOperator</h1><blockquote>
<p>所有的功能性Operator的来源</p>
</blockquote>
<h3 id="2-1-参数："><a href="#2-1-参数：" class="headerlink" title="2.1 参数："></a>2.1 参数：</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">task_id (string) ：唯一标识task的id</span><br><span class="line">owner (string)</span><br><span class="line">retries (int)：任务重试此时</span><br><span class="line">retry_delay (timedelta) ：重试间隔</span><br><span class="line">start_date (datetime)：任务开始时间，第一个任务实例的执行时间</span><br><span class="line">end_date (datetime)：如果指定的话，任务执行不会超过这个时间</span><br><span class="line">depends_on_past (bool)：如果指定的话，任务实例将以此运行并且依赖上一个任务的成功</span><br><span class="line">wait_for_downstream (bool)：在这个参数指定的任何地方，depends_on_past都将强制为true</span><br><span class="line">queue(str)：指定到队列，CeleryExcutor指定特定队列</span><br><span class="line">dag(DAG)：指定dag</span><br><span class="line">pool(str)：此任务运行的插槽池，限制任务的并发</span><br><span class="line">execution_timeout (datetime.timedelta)：执行此任务实例允许的最长时间，超过最长时间则任务失败</span><br><span class="line">sla(datetime.timedelta)：作业预计成功时间</span><br><span class="line">on_failure_callback(callable)：当此任务实例失败时调用的函数</span><br><span class="line">on_retry_callback (callable) ：与on_failure_callback相似，只是重试任务时触发</span><br><span class="line">on_success_callback (callable) ：与on_failure_callback相似，任务成功时触发</span><br><span class="line">trigger_rule (str)：定义依赖的触发规则</span><br><span class="line">  ·包括的选项有：&#123;all_success | all_failed | all_done | one_success | one_failed | dummy&#125;，默认为all_success</span><br><span class="line">run_as_user(str)：在运行任务时使用unix用户名进行模拟</span><br><span class="line">executor_config (dict)：特定的执行程序解释其任务参数</span><br><span class="line">task_concurrency (int)：设置后，任务将限制execution_dates之间的并发运行</span><br><span class="line">resources (dict)：资源参数名称（Resources构造函数的参数名称）与其值的映射。</span><br><span class="line">priority_weight(int)：此任务的优先级权重</span><br><span class="line">weight_rule(str)：用于任务的有效总优先级权重的加权方法</span><br><span class="line">max_retry_delay (timedelta)：重试最大延迟间隔</span><br><span class="line">retry_exponential_backoff (bool)</span><br></pre></td></tr></table></figure>
<h3 id="2-2-方法"><a href="#2-2-方法" class="headerlink" title="2.2 方法"></a>2.2 方法</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">set_downstream(task_or_task_list)</span><br><span class="line">将任务或者任务列表设置为当前任务的下游</span><br><span class="line">set_upstream(task_or_task_list)</span><br><span class="line">将任务或者任务列表设置为当前任务的上游</span><br><span class="line"></span><br><span class="line">clear(start_date=None, end_date=None, upstream=False, downstream=False, session=None)</span><br><span class="line">根据指定参数清除与任务关联的任务实例的状态</span><br><span class="line">execute(context)</span><br><span class="line">创建operator时派生的主要方法</span><br><span class="line">get_direct_relative_ids(upstream=False)</span><br><span class="line">获取当前任务上游或者下游的直接相对id</span><br><span class="line">get_direct_relatives(upstream=False)</span><br><span class="line">获取当前任务的上游或者下游直接关联对象</span><br><span class="line">get_flat_relative_ids(upstream=False, found_descendants=None)</span><br><span class="line">获取上游或者下游的关联对象的id列表</span><br><span class="line">get_flat_relatives(upstream=False)</span><br><span class="line">获取上游或者下游的关联对象列表</span><br><span class="line">get_task_instances(session, start_date=None, end_date=None)</span><br><span class="line">获取特定时间范围的与此任务相关的任务实例</span><br><span class="line">has_dag()</span><br><span class="line">是否设置dag</span><br><span class="line">on_kill()</span><br><span class="line">当任务实例被杀死时，重写方法以清除子进程</span><br><span class="line">run(start_date=None, end_date=None, ignore_first_depends_on_past=False, ignore_ti_state=False, mark_success=False)</span><br><span class="line">为日期范围运行一组任务实例</span><br><span class="line">post_execute(context, result=None)</span><br><span class="line">调用self.execute()后立即触发，它传递上下文和operator返回的结果</span><br><span class="line">pre_execute(context)</span><br><span class="line">调用self.execute()之前触发</span><br><span class="line">prepare_template()</span><br><span class="line">模板化字段被其内容替换之后触发</span><br><span class="line">render_template(attr, content, context)</span><br><span class="line">从文件或直接在字段中呈现模板，并返回呈现结果</span><br><span class="line">render_template_from_field(attr, content, context, jinja_env)</span><br><span class="line">从字段中呈现模板</span><br><span class="line">xcom_pull(context, task_ids=None, dag_id=None, key=&apos;return_value&apos;, include_prior_dates=None)</span><br><span class="line">xcom_push(context, key, value, execution_date=None)</span><br></pre></td></tr></table></figure>
<h3 id="2-3-可调用值"><a href="#2-3-可调用值" class="headerlink" title="2.3 可调用值"></a>2.3 可调用值</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">dag：如果设置了则返回dag，否则报错</span><br><span class="line">deps：返回依赖任务列表</span><br><span class="line">downstream_list：下游任务列表</span><br><span class="line">schedule_interval：任务排列</span><br><span class="line">upstream_list：上游任务列表</span><br></pre></td></tr></table></figure>
<h1 id="3-BaseSensorOperator"><a href="#3-BaseSensorOperator" class="headerlink" title="3. BaseSensorOperator"></a>3. BaseSensorOperator</h1><blockquote>
<p>基于 airflow.models.BaseOperator, airflow.models.SkipMixin</p>
</blockquote>
<h3 id="3-1-参数："><a href="#3-1-参数：" class="headerlink" title="3.1 参数："></a>3.1 参数：</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">soft_fail (bool)：设置为true以将任务标记为失败时的skipped</span><br><span class="line">poke_interval (int)：作业在每次尝试之间应等待的时间（单位：秒）</span><br><span class="line">timeout (int)：超时时间</span><br></pre></td></tr></table></figure>
<h3 id="3-2-方法："><a href="#3-2-方法：" class="headerlink" title="3.2 方法："></a>3.2 方法：</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">execute(context)</span><br><span class="line">poke(context)</span><br></pre></td></tr></table></figure>
<h1 id="4-Core-Operators"><a href="#4-Core-Operators" class="headerlink" title="4. Core Operators"></a>4. Core Operators</h1><h3 id="4-1-airflow-sensors-base-sensor-operator-BaseSensorOperator-poke-interval-60-timeout-604800-soft-fail-False-args-kwargs"><a href="#4-1-airflow-sensors-base-sensor-operator-BaseSensorOperator-poke-interval-60-timeout-604800-soft-fail-False-args-kwargs" class="headerlink" title="4.1 airflow.sensors.base_sensor_operator.BaseSensorOperator(poke_interval=60, timeout=604800, soft_fail=False, *args, **kwargs)"></a>4.1 airflow.sensors.base_sensor_operator.BaseSensorOperator(poke_interval=60, timeout=604800, soft_fail=False, *args, **kwargs)</h3><blockquote>
<p>基于 airflow.models.BaseOperator</p>
</blockquote>
<h4 id="4-1-1-参数："><a href="#4-1-1-参数：" class="headerlink" title="4.1.1 参数："></a>4.1.1 参数：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">bash_command (string)：bash命令</span><br><span class="line">xcom_push (bool)：设置为true，则当bash命令完成之后，写入stdout的最后一行也会被推送到xcom</span><br><span class="line">env (dict)：如果不为None的话，则它定义新进程的环境变量的映射，用于替代当前的进程环境</span><br></pre></td></tr></table></figure>
<h4 id="4-1-2-方法："><a href="#4-1-2-方法：" class="headerlink" title="4.1.2 方法："></a>4.1.2 方法：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">execute(context)</span><br><span class="line">会在临时目录中执行bash，并且之后会对其进行清理</span><br><span class="line">on_kill()</span><br><span class="line">同BaseOperator</span><br></pre></td></tr></table></figure>
<h3 id="4-2-airflow-operators-bash-operator-BashOperator-bash-command-xcom-push-False-env-None-output-encoding-’utf-8’-args-kwargs"><a href="#4-2-airflow-operators-bash-operator-BashOperator-bash-command-xcom-push-False-env-None-output-encoding-’utf-8’-args-kwargs" class="headerlink" title="4.2 airflow.operators.bash_operator.BashOperator(bash_command, xcom_push=False, env=None, output_encoding=’utf-8’, *args, **kwargs)"></a>4.2 airflow.operators.bash_operator.BashOperator(bash_command, xcom_push=False, env=None, output_encoding=’utf-8’, *args, **kwargs)</h3><blockquote>
<p>基于 airflow.operators.python_operator.PythonOperator, airflow.models.SkipMixin</p>
</blockquote>
<h3 id="4-3-airflow-operators-python-operator-BranchPythonOperator-python-callable-op-args-None-op-kwargs-None-provide-context-False-templates-dict-None-templates-exts-None-args-kwargs"><a href="#4-3-airflow-operators-python-operator-BranchPythonOperator-python-callable-op-args-None-op-kwargs-None-provide-context-False-templates-dict-None-templates-exts-None-args-kwargs" class="headerlink" title="4.3 airflow.operators.python_operator.BranchPythonOperator(python_callable, op_args=None, op_kwargs=None, provide_context=False, templates_dict=None, templates_exts=None, *args, **kwargs)"></a>4.3 airflow.operators.python_operator.BranchPythonOperator(python_callable, op_args=None, op_kwargs=None, provide_context=False, templates_dict=None, templates_exts=None, *args, **kwargs)</h3><blockquote>
<p>基于 airflow.operators.python_operator.PythonOperator, airflow.models.SkipMixin</p>
</blockquote>
<h3 id="4-4-airflow-operators-check-operator-CheckOperator-sql-conn-id-None-args-kwargs"><a href="#4-4-airflow-operators-check-operator-CheckOperator-sql-conn-id-None-args-kwargs" class="headerlink" title="4.4 airflow.operators.check_operator.CheckOperator(sql, conn_id=None, *args, **kwargs)"></a>4.4 airflow.operators.check_operator.CheckOperator(sql, conn_id=None, *args, **kwargs)</h3><blockquote>
<p>基于 airflow.models.BaseOperator<br><br>CheckOperator需要返回一个单行的sql查询，第一行的每个值都需要使用python bool cast进行计算，如果任何返回值false，则检查失败并输出错误</p>
</blockquote>
<h4 id="4-4-1-注意："><a href="#4-4-1-注意：" class="headerlink" title="4.4.1 注意："></a>4.4.1 注意：</h4><blockquote>
<p>1）python bool cast 会将一下视作false：<br><br>&emsp;False<br><br>&emsp;0<br><br>&emsp;Empty string (“”)<br><br>&emsp;Empty list ([])<br><br>&emsp;Empty dictionary or set ({})<br><br>2）这是一个抽象类，需要定义get_db_hook，而get_db_hook是钩子，从外部获取单个记录</p>
</blockquote>
<h4 id="4-4-2-参数："><a href="#4-4-2-参数：" class="headerlink" title="4.4.2 参数："></a>4.4.2 参数：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sql (string)：执行的sql语句</span><br></pre></td></tr></table></figure>
<h3 id="4-5-airflow-operators-email-operator-EmailOperator-to-subject-html-content-files-None-cc-None-bcc-None-mime-subtype-’mixed’-mime-charset-’us-ascii’-args-kwargs"><a href="#4-5-airflow-operators-email-operator-EmailOperator-to-subject-html-content-files-None-cc-None-bcc-None-mime-subtype-’mixed’-mime-charset-’us-ascii’-args-kwargs" class="headerlink" title="4.5 airflow.operators.email_operator.EmailOperator(to, subject, html_content, files=None, cc=None, bcc=None, mime_subtype=’mixed’, mime_charset=’us_ascii’, *args, **kwargs)"></a>4.5 airflow.operators.email_operator.EmailOperator(to, subject, html_content, files=None, cc=None, bcc=None, mime_subtype=’mixed’, mime_charset=’us_ascii’, *args, **kwargs)</h3><blockquote>
<p>基于 airflow.models.BaseOperator<br><br>功能：发送一封邮件</p>
</blockquote>
<h4 id="4-5-1-参数："><a href="#4-5-1-参数：" class="headerlink" title="4.5.1 参数："></a>4.5.1 参数：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">to (list or string (comma or semicolon delimited))：发送电子邮件的邮件列表</span><br><span class="line">subject (string)：邮件主题</span><br><span class="line">html_content (string)：邮件内容（允许html标记）</span><br><span class="line">files (list)：附件名称</span><br><span class="line">cc (list or string (comma or semicolon delimited))：抄送列表</span><br><span class="line">bcc (list or string (comma or semicolon delimited))：bcc列表</span><br><span class="line">mime_subtype (string)：MIME字内容类型</span><br><span class="line">mime_charset (string)：字符集参数添加到 Content-Type 头部</span><br></pre></td></tr></table></figure>
<h3 id="4-6-airflow-operators-mysql-operator-MySqlOperator-sql-mysql-conn-id-’mysql-default’-parameters-None-autocommit-False-database-None-args-kwargs"><a href="#4-6-airflow-operators-mysql-operator-MySqlOperator-sql-mysql-conn-id-’mysql-default’-parameters-None-autocommit-False-database-None-args-kwargs" class="headerlink" title="4.6 airflow.operators.mysql_operator.MySqlOperator(sql, mysql_conn_id=’mysql_default’, parameters=None, autocommit=False, database=None, *args, **kwargs)"></a>4.6 airflow.operators.mysql_operator.MySqlOperator(sql, mysql_conn_id=’mysql_default’, parameters=None, autocommit=False, database=None, *args, **kwargs)</h3><blockquote>
<p>基于 airflow.models.BaseOperator<br><br>功能：在指定的mysql数据库中执行sql代码</p>
</blockquote>
<h4 id="4-6-1-参数："><a href="#4-6-1-参数：" class="headerlink" title="4.6.1 参数："></a>4.6.1 参数：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql_conn_id (string)：数据库名</span><br><span class="line">sql：执行的sql语句</span><br><span class="line">database (string)：覆盖连接中定义的数据库名称</span><br></pre></td></tr></table></figure>
<h3 id="4-7-airflow-operators-presto-check-operator-PrestoValueCheckOperator-sql-pass-value-tolerance-None-presto-conn-id-’presto-default’-args-kwargs"><a href="#4-7-airflow-operators-presto-check-operator-PrestoValueCheckOperator-sql-pass-value-tolerance-None-presto-conn-id-’presto-default’-args-kwargs" class="headerlink" title="4.7 airflow.operators.presto_check_operator.PrestoValueCheckOperator(sql, pass_value, tolerance=None, presto_conn_id=’presto_default’, *args, **kwargs)"></a>4.7 airflow.operators.presto_check_operator.PrestoValueCheckOperator(sql, pass_value, tolerance=None, presto_conn_id=’presto_default’, *args, **kwargs)</h3><blockquote>
<p>基于：airflow.models.BaseOperator</p>
</blockquote>
<h4 id="4-7-1-参数："><a href="#4-7-1-参数：" class="headerlink" title="4.7.1 参数："></a>4.7.1 参数：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">python_callable (python callable)：可调用对象的引用</span><br><span class="line">op_kwargs (dict)：关键字参数字典，将在调用函数中解压</span><br><span class="line">op_args (list)：调用callable时将解压缩的位置参数列表</span><br><span class="line">provide_context (bool)：如果设置为true，Airflow将传递一组可在函数中使用的关键字参数。 这组kwargs完全对应于你在jinja模板中可以使用的内容，为此，您需要在函数头中定义** kwargs</span><br><span class="line">templates_dict (dict of str)：一个字典，其中的值是模板，这些模板将在__init__和执行之间的某个时间由Airflow引擎进行模板化，并在应用模板后在可调用的上下文中可用</span><br><span class="line">templates_exts (list(str))：处理模板化字段时要解析的文件扩展名列表</span><br></pre></td></tr></table></figure>
<h3 id="4-8-airflow-operators-python-operator-PythonVirtualenvOperator-python-callable-requirements-None-python-version-None-use-dill-False-system-site-packages-True-op-args-None-op-kwargs-None-string-args-None-templates-dict-None-templates-exts-None-args-kwargs"><a href="#4-8-airflow-operators-python-operator-PythonVirtualenvOperator-python-callable-requirements-None-python-version-None-use-dill-False-system-site-packages-True-op-args-None-op-kwargs-None-string-args-None-templates-dict-None-templates-exts-None-args-kwargs" class="headerlink" title="4.8 airflow.operators.python_operator.PythonVirtualenvOperator(python_callable, requirements=None, python_version=None, use_dill=False, system_site_packages=True, op_args=None, op_kwargs=None, string_args=None, templates_dict=None, templates_exts=None, *args, **kwargs)"></a>4.8 airflow.operators.python_operator.PythonVirtualenvOperator(python_callable, requirements=None, python_version=None, use_dill=False, system_site_packages=True, op_args=None, op_kwargs=None, string_args=None, templates_dict=None, templates_exts=None, *args, **kwargs)</h3><p>###4.9 airflow.operators.python_operator.ShortCircuitOperator(python_callable, op_args=None, op_kwargs=None, provide_context=False, templates_dict=None, templates_exts=None, *args, **kwargs)</p>
<blockquote>
<p>基于：airflow.operators.python_operator.PythonOperator, airflow.models.SkipMixin<br><br>功能：仅在满足条件时才允许工作流继续。 否则，将跳过工作流程“短路”和下游任务。<br>派生自PythonOperator，条件结果由python_callable决定</p>
</blockquote>
<h3 id="4-10-airflow-sensors-http-sensor-HttpSensor-endpoint-http-conn-id-’http-default’-method-’GET’-request-params-None-headers-None-response-check-None-extra-options-None-args-kwargs"><a href="#4-10-airflow-sensors-http-sensor-HttpSensor-endpoint-http-conn-id-’http-default’-method-’GET’-request-params-None-headers-None-response-check-None-extra-options-None-args-kwargs" class="headerlink" title="4.10 airflow.sensors.http_sensor.HttpSensor(endpoint, http_conn_id=’http_default’, method=’GET’, request_params=None, headers=None, response_check=None, extra_options=None, *args, **kwargs)"></a>4.10 airflow.sensors.http_sensor.HttpSensor(endpoint, http_conn_id=’http_default’, method=’GET’, request_params=None, headers=None, response_check=None, extra_options=None, *args, **kwargs)</h3><blockquote>
<p>基于：airflow.sensors.base_sensor_operator.BaseSensorOperator</p>
</blockquote>
<h4 id="4-10-1-参数："><a href="#4-10-1-参数：" class="headerlink" title="4.10.1 参数："></a>4.10.1 参数：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">http_conn_id (string)：连接</span><br><span class="line">method (string)：方法</span><br><span class="line">endpoint (string)：完整的url</span><br><span class="line">request_params (a dictionary of string key/value pairs)：添加到get的url参数</span><br><span class="line">headers (a dictionary of string key/value pairs)：添加到get请求的http头部</span><br><span class="line">response_check (A lambda or defined function.)：检查请求相应对象</span><br><span class="line">extra_options（选项字典，其中key是字符串，值取决于要修改的选项。）：“请求”库的额外选项，请参阅“请求”文档（修改超时，ssl等选项）</span><br></pre></td></tr></table></figure>
<h3 id="4-11-airflow-sensors-sql-sensor-SqlSensor-conn-id-sql-args-kwargs"><a href="#4-11-airflow-sensors-sql-sensor-SqlSensor-conn-id-sql-args-kwargs" class="headerlink" title="4.11 airflow.sensors.sql_sensor.SqlSensor(conn_id, sql, *args, **kwargs)"></a>4.11 airflow.sensors.sql_sensor.SqlSensor(conn_id, sql, *args, **kwargs)</h3><blockquote>
<p>基于：airflow.sensors.base_sensor_operator.BaseSensorOperator<br><br>功能：运行sql语句，直到满足条件。 它将继续尝试，而sql不返回任何行，或者如果第一个单元格返回（0，’0’，’’）</p>
</blockquote>
<h4 id="4-11-1-参数："><a href="#4-11-1-参数：" class="headerlink" title="4.11.1 参数："></a>4.11.1 参数：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">conn_id (string)</span><br><span class="line">sql</span><br></pre></td></tr></table></figure>
<h3 id="4-12-airflow-sensors-time-sensor-TimeSensor-target-time-args-kwargs"><a href="#4-12-airflow-sensors-time-sensor-TimeSensor-target-time-args-kwargs" class="headerlink" title="4.12 airflow.sensors.time_sensor.TimeSensor(target_time, *args, **kwargs)"></a>4.12 airflow.sensors.time_sensor.TimeSensor(target_time, *args, **kwargs)</h3><blockquote>
<p>基于：airflow.sensors.base_sensor_operator.BaseSensorOperator<br><br>功能：等到当天的指定时间</p>
</blockquote>
<h4 id="4-12-1-参数："><a href="#4-12-1-参数：" class="headerlink" title="4.12.1 参数："></a>4.12.1 参数：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">target_time (datetime.time)</span><br></pre></td></tr></table></figure>
<h3 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">4.13 airflow.sensors.time_delta_sensor.TimeDeltaSensor(delta, *args, **kwargs)</span><br><span class="line">4.14 airflow.sensors.web_hdfs_sensor.WebHdfsSensor(filepath, webhdfs_conn_id=&apos;webhdfs_default&apos;, *args, **kwargs)</span><br><span class="line">4.15 airflow.operators.latest_only_operator.LatestOnlyOperator(task_id, owner=&apos;Airflow&apos;, email=None, email_on_retry=True, email_on_failure=True, retries=0, retry_delay=datetime.timedelta(0, 300), retry_exponential_backoff=False, max_retry_delay=None, start_date=None, end_date=None, schedule_interval=None, depends_on_past=False, wait_for_downstream=False, dag=None, params=None, default_args=None, adhoc=False, priority_weight=1, weight_rule=&apos;downstream&apos;, queue=&apos;default&apos;, pool=None, sla=None, execution_timeout=None, on_failure_callback=None, on_success_callback=None, on_retry_callback=None, trigger_rule=&apos;all_success&apos;, resources=None, run_as_user=None, task_concurrency=None, executor_config=None, inlets=None, outlets=None, *args, **kwargs)</span><br><span class="line">4.16 airflow.operators.mssql_operator.MsSqlOperator(sql, mssql_conn_id=&apos;mssql_default&apos;, parameters=None, autocommit=False, database=None, *args, **kwargs)</span><br><span class="line">4.17 airflow.operators.mssql_to_hive.MsSqlToHiveTransfer(sql, hive_table, create=True, recreate=False, partition=None, delimiter=&apos;x01&apos;, mssql_conn_id=&apos;mssql_default&apos;, hive_cli_conn_id=&apos;hive_cli_default&apos;, tblproperties=None, *args, **kwargs)</span><br><span class="line">4.18 airflow.operators.dummy_operator.DummyOperator(*args, **kwargs)</span><br><span class="line">4.19 airflow.operators.mysql_to_hive.MySqlToHiveTransfer(sql, hive_table, create=True, recreate=False, partition=None, delimiter=&apos;x01&apos;, mysql_conn_id=&apos;mysql_default&apos;, hive_cli_conn_id=&apos;hive_cli_default&apos;, tblproperties=None, *args, **kwargs)</span><br><span class="line">4.20 airflow.operators.oracle_operator.OracleOperator(sql, oracle_conn_id=&apos;oracle_default&apos;, parameters=None, autocommit=False, *args, **kwargs)</span><br><span class="line">4.21 airflow.operators.pig_operator.PigOperator(pig, pig_cli_conn_id=&apos;pig_cli_default&apos;, pigparams_jinja_translate=False, *args, **kwargs)</span><br><span class="line">4.22 airflow.operators.postgres_operator.PostgresOperator(sql, postgres_conn_id=&apos;postgres_default&apos;, autocommit=False, parameters=None, database=None, *args, **kwargs)</span><br><span class="line">4.23 airflow.operators.presto_check_operator.PrestoCheckOperator(sql, presto_conn_id=&apos;presto_default&apos;, *args, **kwargs)</span><br><span class="line">4.24 airflow.operators.presto_check_operator.PrestoIntervalCheckOperator(table, metrics_thresholds, date_filter_column=&apos;ds&apos;, days_back=-7, presto_conn_id=&apos;presto_default&apos;, *args, **kwargs)</span><br><span class="line">4.25 airflow.operators.presto_to_mysql.PrestoToMySqlTransfer(sql, mysql_table, presto_conn_id=&apos;presto_default&apos;, mysql_conn_id=&apos;mysql_default&apos;, mysql_preoperator=None, *args, **kwargs)</span><br><span class="line">4.26 airflow.operators.druid_check_operator.DruidCheckOperator(sql, druid_broker_conn_id=&apos;druid_broker_default&apos;, *args, **kwargs)</span><br><span class="line">4.27 airflow.operators.generic_transfer.GenericTransfer(sql, destination_table, source_conn_id, destination_conn_id, preoperator=None, *args, **kwargs)</span><br><span class="line">4.28 airflow.operators.hive_to_druid.HiveToDruidTransfer(sql, druid_datasource, ts_dim, metric_spec=None, hive_cli_conn_id=&apos;hive_cli_default&apos;, druid_ingest_conn_id=&apos;druid_ingest_default&apos;, metastore_conn_id=&apos;metastore_default&apos;, hadoop_dependency_coordinates=None, intervals=None, num_shards=-1, target_partition_size=-1, query_granularity=&apos;NONE&apos;, segment_granularity=&apos;DAY&apos;, hive_tblproperties=None, *args, **kwargs)</span><br><span class="line">4.29 airflow.operators.s3_file_transform_operator.S3FileTransformOperator(source_s3_key, dest_s3_key, transform_script=None, select_expression=None, source_aws_conn_id=&apos;aws_default&apos;, dest_aws_conn_id=&apos;aws_default&apos;, replace=False, *args, **kwargs)</span><br><span class="line">4.30 airflow.operators.s3_to_hive_operator.S3ToHiveTransfer(s3_key, field_dict, hive_table, delimiter=&apos;, &apos;, create=True, recreate=False, partition=None, headers=False, check_headers=False, wildcard_match=False, aws_conn_id=&apos;aws_default&apos;, hive_cli_conn_id=&apos;hive_cli_default&apos;, input_compressed=False, tblproperties=None, select_expression=None, *args, **kwargs)</span><br><span class="line">4.31 airflow.operators.s3_to_redshift_operator.S3ToRedshiftTransfer(schema, table, s3_bucket, s3_key, redshift_conn_id=&apos;redshift_default&apos;, aws_conn_id=&apos;aws_default&apos;, copy_options=(), autocommit=False, parameters=None, *args, **kwargs)</span><br><span class="line">4.32 airflow.operators.hive_to_mysql.HiveToMySqlTransfer(sql, mysql_table, hiveserver2_conn_id=&apos;hiveserver2_default&apos;, mysql_conn_id=&apos;mysql_default&apos;, mysql_preoperator=None, mysql_postoperator=None, bulk_load=False, *args, **kwargs)</span><br><span class="line">4.33 airflow.operators.hive_to_samba_operator.Hive2SambaOperator(hql, destination_filepath, samba_conn_id=&apos;samba_default&apos;, hiveserver2_conn_id=&apos;hiveserver2_default&apos;, *args, **kwargs)</span><br><span class="line">4.34 airflow.sensors.metastore_partition_sensor.MetastorePartitionSensor(table, partition_name, schema=&apos;default&apos;, mysql_conn_id=&apos;metastore_mysql&apos;, *args, **kwargs)</span><br><span class="line">4.35 airflow.sensors.named_hive_partition_sensor.NamedHivePartitionSensor(partition_names, metastore_conn_id=&apos;metastore_default&apos;, poke_interval=180, hook=None, *args, **kwargs)</span><br><span class="line">4.36 airflow.sensors.s3_key_sensor.S3KeySensor(bucket_key, bucket_name=None, wildcard_match=False, aws_conn_id=&apos;aws_default&apos;, *args, **kwargs)</span><br><span class="line">4.37 airflow.sensors.s3_prefix_sensor.S3PrefixSensor(bucket_name, prefix, delimiter=&apos;/&apos;, aws_conn_id=&apos;aws_default&apos;, *args, **kwargs)</span><br><span class="line">4.38 airflow.operators.hive_operator.HiveOperator(hql, hive_cli_conn_id=&apos;hive_cli_default&apos;, schema=&apos;default&apos;, hiveconfs=None, hiveconf_jinja_translate=False, script_begin_tag=None, run_as_owner=False, mapred_queue=None, mapred_queue_priority=None, mapred_job_name=None, *args, **kwargs)</span><br><span class="line">4.39 airflow.operators.hive_stats_operator.HiveStatsCollectionOperator(table, partition, extra_exprs=None, col_blacklist=None, assignment_func=None, metastore_conn_id=&apos;metastore_default&apos;, presto_conn_id=&apos;presto_default&apos;, mysql_conn_id=&apos;airflow_db&apos;, *args, **kwargs)</span><br><span class="line">4.40 airflow.operators.check_operator.IntervalCheckOperator(table, metrics_thresholds, date_filter_column=&apos;ds&apos;, days_back=-7, conn_id=None, *args, **kwargs)</span><br><span class="line">4.41 airflow.operators.jdbc_operator.JdbcOperator(sql, jdbc_conn_id=&apos;jdbc_default&apos;, autocommit=False, parameters=None, *args, **kwargs)</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/12/03/airflow1/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="fengchuanling">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="枫川棂">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/12/03/airflow1/" itemprop="url">centos7 超完整安装airflow</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-12-03T17:10:42+08:00">
                2018-12-03
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/python-框架/" itemprop="url" rel="index">
                    <span itemprop="name">python-框架</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="1-airflow完整安装流程"><a href="#1-airflow完整安装流程" class="headerlink" title="1. airflow完整安装流程"></a>1. airflow完整安装流程</h1><h2 id="1-1-airflow-基础安装"><a href="#1-1-airflow-基础安装" class="headerlink" title="1.1 airflow 基础安装"></a>1.1 airflow 基础安装</h2><h5 id="1）默认自带python2环境，自行安装pip"><a href="#1）默认自带python2环境，自行安装pip" class="headerlink" title="1）默认自带python2环境，自行安装pip"></a>1）默认自带python2环境，自行安装pip</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum -y install epel-release</span><br><span class="line">yum install python-pip</span><br></pre></td></tr></table></figure>
<h5 id="2）进行pip的更新，否则很多安装会报错"><a href="#2）进行pip的更新，否则很多安装会报错" class="headerlink" title="2）进行pip的更新，否则很多安装会报错"></a>2）进行pip的更新，否则很多安装会报错</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pip install --upgrade pip</span><br><span class="line">pip install --upgrade setuptools</span><br></pre></td></tr></table></figure>
<h5 id="3）安装开发库"><a href="#3）安装开发库" class="headerlink" title="3）安装开发库"></a>3）安装开发库</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yum install python-devel</span><br><span class="line">yum install libevent-devel</span><br><span class="line">yum install mysql-devel</span><br></pre></td></tr></table></figure>
<h5 id="4）安装centos7下的mysql"><a href="#4）安装centos7下的mysql" class="headerlink" title="4）安装centos7下的mysql"></a>4）安装centos7下的mysql</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">yum -y install mariadb mariadb-server</span><br><span class="line">启动并设置开机启动</span><br><span class="line">systemctl start mariadb</span><br><span class="line">systemctl enable mariadb</span><br></pre></td></tr></table></figure>
<h5 id="5）初始化配置mysql"><a href="#5）初始化配置mysql" class="headerlink" title="5）初始化配置mysql"></a>5）初始化配置mysql</h5><blockquote>
<p>注：可以设定允许root远程登录，并且删除test和None用户，这样才能使得mysql允许远程登录<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql_secure_installation</span><br></pre></td></tr></table></figure></p>
</blockquote>
<h5 id="6）安装airflow"><a href="#6）安装airflow" class="headerlink" title="6）安装airflow"></a>6）安装airflow</h5><blockquote>
<p>在此之前需要设定临时环境变量<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">export SLUGIFY_USES_TEXT_UNIDECODE=yes</span><br><span class="line">pip install apache-airflow</span><br></pre></td></tr></table></figure></p>
</blockquote>
<h5 id="7）初始化airflow并启动"><a href="#7）初始化airflow并启动" class="headerlink" title="7）初始化airflow并启动"></a>7）初始化airflow并启动</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">airflow initdb</span><br><span class="line">airflow webserver -p 8080</span><br></pre></td></tr></table></figure>
<h5 id="8）防止密码明文存储"><a href="#8）防止密码明文存储" class="headerlink" title="8）防止密码明文存储"></a>8）防止密码明文存储</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install cryptography</span><br></pre></td></tr></table></figure>
<h2 id="1-2-airflow-mysql安装"><a href="#1-2-airflow-mysql安装" class="headerlink" title="1.2 airflow mysql安装"></a>1.2 airflow mysql安装</h2><h5 id="1）安装airflow-mysql"><a href="#1）安装airflow-mysql" class="headerlink" title="1）安装airflow-mysql"></a>1）安装airflow-mysql</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install apache-airflow[mysql]</span><br></pre></td></tr></table></figure>
<h5 id="2）创建airflow用户-创建airflow数据库并给出所有权限给次用户"><a href="#2）创建airflow用户-创建airflow数据库并给出所有权限给次用户" class="headerlink" title="2）创建airflow用户,创建airflow数据库并给出所有权限给次用户"></a>2）创建airflow用户,创建airflow数据库并给出所有权限给次用户</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">create database airflow;</span><br><span class="line">create user &apos;testairflow&apos;@&apos;%&apos; identified by &apos;123123&apos;;</span><br><span class="line">GRANT all privileges on airflow.* TO &apos;testairflow&apos;@&apos;%&apos;  IDENTIFIED BY &apos;123123&apos;;</span><br><span class="line">FLUSH PRIVILEGES;</span><br></pre></td></tr></table></figure>
<h5 id="3）修改airflow配置文件，指向数据库mysql"><a href="#3）修改airflow配置文件，指向数据库mysql" class="headerlink" title="3）修改airflow配置文件，指向数据库mysql"></a>3）修改airflow配置文件，指向数据库mysql</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~/airflow/airflow.cfg 文件修改：sql_alchemy_conn = mysql://ct:152108@localhost/airflow</span><br></pre></td></tr></table></figure>
<h5 id="4）进行mariadb更新，从5-5-60升级为10-2-19，然后修改配置文件添加参数-之后初始化数据库"><a href="#4）进行mariadb更新，从5-5-60升级为10-2-19，然后修改配置文件添加参数-之后初始化数据库" class="headerlink" title="4）进行mariadb更新，从5.5.60升级为10.2.19，然后修改配置文件添加参数,之后初始化数据库"></a>4）<a href="https://www.cnblogs.com/ZhangShY/p/10059508.html" target="_blank" rel="noopener">进行mariadb更新，从5.5.60升级为10.2.19，</a>然后修改配置文件添加参数,之后初始化数据库</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/my.cnf</span><br><span class="line">explicit_defaults_for_timestamp=1   // 添加此行</span><br><span class="line">systemctl restart mariadb</span><br><span class="line">airflow initdb</span><br></pre></td></tr></table></figure>
<h2 id="1-3-airflow-安装配置celery-rabbitmq（官方推荐使用rabblitmq）"><a href="#1-3-airflow-安装配置celery-rabbitmq（官方推荐使用rabblitmq）" class="headerlink" title="1.3 airflow 安装配置celery+rabbitmq（官方推荐使用rabblitmq）"></a>1.3 airflow 安装配置celery+rabbitmq（官方推荐使用rabblitmq）</h2><h3 id="1-3-1-安装celery和rabbitmq组件"><a href="#1-3-1-安装celery和rabbitmq组件" class="headerlink" title="1.3.1 安装celery和rabbitmq组件"></a>1.3.1 安装celery和rabbitmq组件</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pip install airflow[celery] </span><br><span class="line">pip install airflow[rabbitmq]</span><br></pre></td></tr></table></figure>
<h3 id="1-3-2-系统安装rabbit"><a href="#1-3-2-系统安装rabbit" class="headerlink" title="1.3.2 系统安装rabbit"></a>1.3.2 系统安装rabbit</h3><h5 id="1）安装-erlang"><a href="#1）安装-erlang" class="headerlink" title="1）安装 erlang"></a>1）安装 erlang</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install erlang</span><br></pre></td></tr></table></figure>
<h5 id="2）安装-rabbitmq"><a href="#2）安装-rabbitmq" class="headerlink" title="2）安装 rabbitmq"></a>2）安装 rabbitmq</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wget http://www.rabbitmq.com/releases/rabbitmq-server/v3.6.15/rabbitmq-server-3.6.15-1.el6.noarch.rpm</span><br><span class="line">rpm --import https://www.rabbitmq.com/rabbitmq-release-signing-key.asc</span><br><span class="line">yum install rabbitmq-server-3.6.15-1.el6.noarch.rpm</span><br></pre></td></tr></table></figure>
<h5 id="3）配置rabbitmq（设置用户名root，密码123123，创建虚拟主机airflow-rabbitmq）"><a href="#3）配置rabbitmq（设置用户名root，密码123123，创建虚拟主机airflow-rabbitmq）" class="headerlink" title="3）配置rabbitmq（设置用户名root，密码123123，创建虚拟主机airflow-rabbitmq）"></a>3）配置rabbitmq（设置用户名root，密码123123，创建虚拟主机airflow-rabbitmq）</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">rabbitmqctl add_user root rabbitmq</span><br><span class="line">rabbitmqctl add_vhost airflow-rabbitmq</span><br><span class="line">rabbitmqctl set_user_tags root airflow-rabbitmq</span><br><span class="line">rabbitmqctl set_permissions -p airflow-rabbitmq root &quot;.*&quot; &quot;.*&quot; &quot;.*&quot;</span><br><span class="line">rabbitmq-plugins enable rabbitmq_management</span><br></pre></td></tr></table></figure>
<h3 id="1-3-3-修改airflow配置文件"><a href="#1-3-3-修改airflow配置文件" class="headerlink" title="1.3.3 修改airflow配置文件"></a>1.3.3 修改airflow配置文件</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">executor = CeleryExecutor</span><br><span class="line">broker_url = amqp://root:123123@localhost:5672/airflow-rabbitmq</span><br><span class="line">result_backend = amqp://root:123123@localhost:5672/airflow-rabbitmq</span><br></pre></td></tr></table></figure>
<h3 id="1-4-airflow-安装配置celery-redis"><a href="#1-4-airflow-安装配置celery-redis" class="headerlink" title="1.4 airflow 安装配置celery+redis"></a>1.4 airflow 安装配置celery+redis</h3><h3 id="1-3-1-安装redis"><a href="#1-3-1-安装redis" class="headerlink" title="1.3.1 安装redis"></a>1.3.1 安装redis</h3><h5 id="1）系统安装redis"><a href="#1）系统安装redis" class="headerlink" title="1）系统安装redis"></a>1）系统安装redis</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install redis</span><br></pre></td></tr></table></figure>
<h5 id="2）修改配置文件"><a href="#2）修改配置文件" class="headerlink" title="2）修改配置文件"></a>2）修改配置文件</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/redis.conf</span><br><span class="line">#bind 127.0.0.1 	// 注释掉，使redis允许远程访问</span><br><span class="line">requirepass 密码	// 修改这行，redis登录密码</span><br></pre></td></tr></table></figure>
<h5 id="3）开启redis服务"><a href="#3）开启redis服务" class="headerlink" title="3）开启redis服务"></a>3）开启redis服务</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl start redis</span><br></pre></td></tr></table></figure>
<h5 id="4）python下安装redis库"><a href="#4）python下安装redis库" class="headerlink" title="4）python下安装redis库"></a>4）python下安装redis库</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install redis</span><br></pre></td></tr></table></figure>
<h3 id="1-3-2-安装celery"><a href="#1-3-2-安装celery" class="headerlink" title="1.3.2 安装celery"></a>1.3.2 安装celery</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install celery</span><br></pre></td></tr></table></figure>
<h3 id="1-3-3-配置airflow-cfg"><a href="#1-3-3-配置airflow-cfg" class="headerlink" title="1.3.3 配置airflow.cfg"></a>1.3.3 配置airflow.cfg</h3><p>修改内容：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">executor = CeleryExecutor</span><br><span class="line">broker_url = redis://127.0.0.1:6379/0</span><br><span class="line">result_backend = redis://127.0.0.1:6379/0</span><br></pre></td></tr></table></figure></p>
<h3 id="1-3-4-airflow常用命令"><a href="#1-3-4-airflow常用命令" class="headerlink" title="1.3.4 airflow常用命令"></a>1.3.4 airflow常用命令</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">airflow webserver -p 8080	// 打开web服务</span><br><span class="line">airflow scheduler 		//打开调度器，必须启动，不然DAG在使用celeryExecutor和LocalExcutor没法run起来</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">airflow list_dags			//查看已有的dag列表</span><br><span class="line">airflow list_tasks tutorial	        //查看某个dag下的任务</span><br><span class="line">airflow list_tasks tutorial --tree 	//树形结构查看</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">airflow test dag_name task_name test_time</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">airflow run dagid [time] run task instance</span><br><span class="line">airflow backfill [dagid] -s[startTime] -e [endTime] run a backfill over 2 days</span><br></pre></td></tr></table></figure>
<h1 id="3-airflow-架构"><a href="#3-airflow-架构" class="headerlink" title="3. airflow 架构"></a>3. airflow 架构</h1><h2 id="3-1核心概念："><a href="#3-1核心概念：" class="headerlink" title="3.1核心概念："></a>3.1核心概念：</h2><blockquote>
<p>DAG有向无环图<br><br>一个DAG由多个task组成</p>
</blockquote>
<h2 id="3-2-包含组件："><a href="#3-2-包含组件：" class="headerlink" title="3.2 包含组件："></a>3.2 包含组件：</h2><h5 id="1）一个元数据库-mysql"><a href="#1）一个元数据库-mysql" class="headerlink" title="1）一个元数据库(mysql)"></a>1）一个元数据库(mysql)</h5><h5 id="2）一组airflow工作节点"><a href="#2）一组airflow工作节点" class="headerlink" title="2）一组airflow工作节点"></a>2）一组airflow工作节点</h5><h5 id="3）一个调节器-redis或RabbitMQ"><a href="#3）一个调节器-redis或RabbitMQ" class="headerlink" title="3）一个调节器(redis或RabbitMQ)"></a>3）一个调节器(redis或RabbitMQ)</h5><h5 id="4）一个airflow-web服务器"><a href="#4）一个airflow-web服务器" class="headerlink" title="4）一个airflow web服务器"></a>4）一个airflow web服务器</h5><h2 id="3-3-工作流依赖种类："><a href="#3-3-工作流依赖种类：" class="headerlink" title="3.3 工作流依赖种类："></a>3.3 工作流依赖种类：</h2><h5 id="1）时间依赖：定时触发任务"><a href="#1）时间依赖：定时触发任务" class="headerlink" title="1）时间依赖：定时触发任务"></a>1）时间依赖：定时触发任务</h5><p><code>完整支持crontab表达式，还支持python的datatime</code></p>
<h5 id="2）任务间依赖：任务A需要在任务B完成的基础上触发"><a href="#2）任务间依赖：任务A需要在任务B完成的基础上触发" class="headerlink" title="2）任务间依赖：任务A需要在任务B完成的基础上触发"></a>2）任务间依赖：任务A需要在任务B完成的基础上触发</h5><blockquote>
<h5 id="3）权限依赖：用户权限管理"><a href="#3）权限依赖：用户权限管理" class="headerlink" title="3）权限依赖：用户权限管理"></a>3）权限依赖：用户权限管理</h5><h5 id="4）机器依赖：任务的执行只能在某些指定机器上执行"><a href="#4）机器依赖：任务的执行只能在某些指定机器上执行" class="headerlink" title="4）机器依赖：任务的执行只能在某些指定机器上执行"></a>4）机器依赖：任务的执行只能在某些指定机器上执行</h5><p><code>在celeryExcuter可以使用不同的用户启动worker，不同的worker监听不同的queue，解决用户权限依赖问题；worker也可以启动在不同的机器上，解决机器依赖问题</code></p>
<h5 id="5）外部系统依赖：依赖各种外部数据库数据等，并且需要调用接口访问外部数据"><a href="#5）外部系统依赖：依赖各种外部数据库数据等，并且需要调用接口访问外部数据" class="headerlink" title="5）外部系统依赖：依赖各种外部数据库数据等，并且需要调用接口访问外部数据"></a>5）外部系统依赖：依赖各种外部数据库数据等，并且需要调用接口访问外部数据</h5><p><code>有一个hook机制，作用时建立一个与外部数据系统的连接，比如mysql、hdfs、本地文件系统，通过拓展的hook</code></p>
</blockquote>
<h5 id="6）资源依赖：某些任务消耗机器资源非常多，进行任务执行时需要对任务进行限制"><a href="#6）资源依赖：某些任务消耗机器资源非常多，进行任务执行时需要对任务进行限制" class="headerlink" title="6）资源依赖：某些任务消耗机器资源非常多，进行任务执行时需要对任务进行限制"></a>6）资源依赖：某些任务消耗机器资源非常多，进行任务执行时需要对任务进行限制</h5><blockquote>
<p><code>可以为任意的task指定一个抽象的pool，每个pool指定一个slot数，每启动一个task任务就占用一个slot数，当slot数占满之后就进入等待状态</code></p>
</blockquote>
<h1 id="3-4-基本使用过程"><a href="#3-4-基本使用过程" class="headerlink" title="3.4 基本使用过程"></a>3.4 基本使用过程</h1><h5 id="1）根据实际需要，使用不同的Operator"><a href="#1）根据实际需要，使用不同的Operator" class="headerlink" title="1）根据实际需要，使用不同的Operator"></a>1）根据实际需要，使用不同的Operator</h5><h5 id="2）传入具体的参数，定义一系列的tasks-operator是task的抽象类"><a href="#2）传入具体的参数，定义一系列的tasks-operator是task的抽象类" class="headerlink" title="2）传入具体的参数，定义一系列的tasks    // operator是task的抽象类"></a>2）传入具体的参数，定义一系列的tasks    // operator是task的抽象类</h5><h5 id="3）定义tasks之间的关系，形成一个DAG"><a href="#3）定义tasks之间的关系，形成一个DAG" class="headerlink" title="3）定义tasks之间的关系，形成一个DAG"></a>3）定义tasks之间的关系，形成一个DAG</h5><h5 id="4）调度DAG运行，每个task会形成一个instance"><a href="#4）调度DAG运行，每个task会形成一个instance" class="headerlink" title="4）调度DAG运行，每个task会形成一个instance"></a>4）调度DAG运行，每个task会形成一个instance</h5><h5 id="5）使用命令或者web-ui进行查看管理"><a href="#5）使用命令或者web-ui进行查看管理" class="headerlink" title="5）使用命令或者web ui进行查看管理"></a>5）使用命令或者web ui进行查看管理</h5>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  


          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">fengchuanling</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">4</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">1</span>
                  <span class="site-state-item-name">categories</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">4</span>
                  <span class="site-state-item-name">tags</span>
                </a>
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">fengchuanling</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
